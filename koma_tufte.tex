% This template has been adapted from https://github.com/jgm/pandoc-templates
% that comes attached with the following copyright notice. It also includes
% segments from the R Markdown template that in turn is based on the pandoc
% template.
%
% Copyright (c) 2014--2017, John MacFarlane
%
% All rights reserved.
%
% Redistribution and use in source and binary forms, with or without
% modification, are permitted provided that the following conditions are met:
%
% * Redistributions of source code must retain the above copyright notice,
%   this list of conditions and the following disclaimer.
% * Redistributions in binary form must reproduce the above copyright notice,
%   this list of conditions and the following disclaimer in the documentation
%   and/or other materials provided with the distribution.
% * Neither the name of John MacFarlane nor the names of other contributors may
%   be used to endorse or promote products derived from this software without
%   specific prior written permission.
%
% THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
% AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
% IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
% ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE
% LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
% CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
% SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
% INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
% CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
% ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
% POSSIBILITY OF SUCH DAMAGE.

\PassOptionsToPackage{unicode=true}{hyperref} % options for packages loaded elsewhere
\PassOptionsToPackage{hyphens}{url}
\PassOptionsToPackage{dvipsnames,svgnames*,x11names*}{xcolor}
%
\PassOptionsToPackage{font=small,
                      labelfont=bf,
                      labelsep=period,
                      justification=RaggedRight,
                      format=plain,
                      tableposition=top,
                      singlelinecheck=off}{caption}

\documentclass[%
numbers=noendperiod,
parskip=half,
bibliography=totoc,
DIV=calc,headsepline=true,
]{scrartcl}

\usepackage{multicol}

% Margin paragraph
\usepackage{marginfix}
%\usepackage{morefloats} % More than 18 floats

\usepackage[font=footnotesize]{subcaption}
\usepackage{booktabs}
\usepackage[document]{ragged2e}
\usepackage[shortlabels]{enumitem}
\usepackage{etoolbox}
\usepackage{floatrow}
\usepackage{environ}
\usepackage{xspace}

\usepackage{ifxetex,ifluatex}


\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex

% Fonts

\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage{amsthm}
\usepackage[lining]{libertine}
\usepackage{textcomp}
\usepackage[scaled=0.96,varqu,varl]{inconsolata}
\usepackage{mathtools}
\usepackage[libertine,libaltvw,liby,vvarbb]{newtxmath}
\IfFileExists{mathalfa.sty}{\usepackage[scr=boondoxo]{mathalfa}}{}
\IfFileExists{bm.sty}{\usepackage{bm}}{}
\useosf

\else % if luatex or xelatex
  \usepackage{unicode-math}
  \defaultfontfeatures{Ligatures=TeX,Scale=MatchLowercase}
\fi

% use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
% use microtype if available
\IfFileExists{microtype.sty}{%
\usepackage[]{microtype}
\UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\IfFileExists{parskip.sty}{%
\usepackage{parskip}
}{% else
\setlength{\parindent}{0pt}
\setlength{\parskip}{6pt plus 2pt minus 1pt}
}
\usepackage{xcolor}
\usepackage{hyperref}
\usepackage{cleveref}
\hypersetup{
            pdftitle={Koma Tufte},
            colorlinks=true,
            linkcolor=PineGreen,
            filecolor=PineGreen,
            citecolor=Periwinkle,
            urlcolor=NavyBlue,
            breaklinks=true}
\urlstyle{same}  % don't use monospace font for urls

% Set tufte-like page layout
\usepackage[
        a4paper,
  left=23mm,
  top=27.4mm,
  bottom=27.4mm,
  textwidth=107mm,
  marginparsep=8mm,
  marginparwidth=49mm]{geometry}

\usepackage{longtable,booktabs}
% Fix footnotes in tables (requires footnote package)
\IfFileExists{footnote.sty}{\usepackage{footnote}\makesavenoteenv{longtable}}{}

\usepackage{graphicx,grffile}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}

\setlength{\emergencystretch}{3em}  % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{5}

% Redefines (sub)paragraphs to behave more like sections
\ifx\paragraph\undefined\else
\let\oldparagraph\paragraph
\renewcommand{\paragraph}[1]{\oldparagraph{#1}\mbox{}}
\fi
\ifx\subparagraph\undefined\else
\let\oldsubparagraph\subparagraph
\renewcommand{\subparagraph}[1]{\oldsubparagraph{#1}\mbox{}}
\fi

% set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother



% Block margins for caption around figure and table environments
\BeforeBeginEnvironment{figure}{\blockmargin}
\AfterEndEnvironment{figure}{\unblockmargin}
\BeforeBeginEnvironment{widefigure}{\blockmargin}
\AfterEndEnvironment{widefigure}{\unblockmargin}
\BeforeBeginEnvironment{table}{\blockmargin}
\AfterEndEnvironment{table}{\unblockmargin}
\BeforeBeginEnvironment{longtable}{\blockmargin}
\AfterEndEnvironment{longtable}{\unblockmargin}

% Algorithms
\IfFileExists{algpseudocode.sty}{%
\usepackage[noend]{algpseudocode}
\DeclareNewFloatType{algorithm}{fileext=alg, name=Algorithm}
\floatsetup[algorithm]{margins=hangright,
                       capposition=beside,
                       capbesidesep=marginparsep,
                       capbesideposition={top,right},
                       floatwidth=\textwidth}%
\BeforeBeginEnvironment{algorithm}{\blockmargin}
\AfterEndEnvironment{algorithm}{\unblockmargin}
}{}

% Floats
\DeclareNewFloatType{widefigure}{fileext=wfig, name=Figure}
\DeclareFloatSeparators{marginparsep}{\hskip\marginparsep}
\floatsetup[figure]{margins=hangright,
                    capposition=beside,
                    capbesidesep=marginparsep,
                    capbesideposition={top,right},
                    floatwidth=\textwidth}
\floatsetup[table]{margins=hangright,
                   capposition=beside,
                   capbesidesep=marginparsep,
                   capbesideposition={top,right},
                   floatwidth=\textwidth}
\floatsetup[longtable]{margins=hangright,
                       capposition=beside,
                       capbesidesep=marginparsep,
                       capbesideposition={top,right},
                       floatwidth=\textwidth}
\floatsetup[widefigure]{margins=hangright,
                        capposition=bottom}
\floatsetup[widetable]{margins=hangright,
                       capposition=top}
\captionsetup[subfigure]{position=b,justification=RaggedRight}
\captionsetup[sub]{justification=RaggedRight}

% Provide marginfigure
\NewEnviron{marginfigure}{%
  \marginpar{%
    \captionsetup{type=figure}
    \BODY
  }%
}

% Provide margintable
\NewEnviron{margintable}{%
  \marginpar{%
    \captionsetup{type=table}
    \BODY
  }%
}

% Extended verbatim environments
\usepackage{fancyvrb}
\fvset{fontsize=\small}% default font size for fancy-verbatim environments

% Provide fullwidth environment
\newlength{\overhang}
\setlength{\overhang}{\marginparwidth}
\addtolength{\overhang}{\marginparsep}

\newenvironment{fullwidth}{%
  \blockmargin
  \begin{addmargin*}[0em]{-\overhang}%
}{%
  \end{addmargin*}%
  \unblockmargin
}

% Use protect on footnotes to avoid problems with footnotes in titles
\let\rmarkdownfootnote\footnote%
\def\footnote{\protect\rmarkdownfootnote}

\usepackage{graphicx,grffile}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}

\title{Koma Tufte}

\subtitle{KOMA-script articles with komadown}

% Subfigs
%\usepackage[margin=1em]{subfig}

% Authors
\usepackage[noblocks]{authblk}
\renewcommand\Affilfont{\normalfont\itshape\small}
\renewcommand\Authfont{}

\author[]{Joey Trampush}


\date{2019-03-23}

% Headers and footers
\usepackage[headsepline=false,
                        automark,
                        headwidth=textwithmarginpar,
            footwidth=head]{scrlayer-scrpage}

\pagestyle{scrheadings}

\automark[subsection]{section}
% \clearmainofpairofpagestyles

\clearpairofpagestyles
\rofoot[\pagemark]{\pagemark}
\lohead{\headmark}

\rohead[]{komadown}


% New, custom title
\usepackage{titling}
\setlength{\droptitle}{-5em}
\pretitle{\begin{flushleft}\huge\bfseries\sffamily}
\posttitle{
    \\\smallskip\normalfont\itshape\large KOMA-script articles with komadown
    \end{flushleft}
}
\preauthor{\begin{flushleft}\Large\scshape}
\postauthor{\end{flushleft}\normalfont}
\predate{\begin{flushleft}\large\itshape}
\postdate{\end{flushleft}}

% Captions
\usepackage[font=footnotesize]{subcaption}
%\captionsetup[sub]{font = footnotesize}


% Text justification and parskip
\usepackage[document]{ragged2e}

% Lists
\usepackage[shortlabels]{enumitem}

% Caption styles (caption package is loaded with sidenotes)
\DeclareCaptionStyle{sidecaption}{labelfont=bf,labelsep=period,font=small}
\DeclareCaptionStyle{marginfigure}{labelfont=bf,labelsep=period,font=small}
\DeclareCaptionStyle{margintable}{labelfont=bf,labelsep=period,font=small,position=top}
\DeclareCaptionStyle{widefigure}{labelfont=bf,labelsep=period,font=small}
\DeclareCaptionStyle{widetable}{labelfont=bf,labelsep=period,font=small}

% Redefine footnotes to be marginnotes
\newcounter{snmark}
\setcounter{snmark}{0}

\newcommand*{\makesidenotemark}{\/\textsuperscript{\thesnmark}}

\renewcommand{\footnote}[1]{%
  \refstepcounter{snmark}%
  \makesidenotemark{}%
  \marginpar{\RaggedRight\small\textsuperscript{\thesnmark}\,#1}%
}

% Put thanks in marginpar
\renewcommand{\thanks}[1]{%
  \footnotemark%
  \marginpar{\RaggedRight\small\textsuperscript{\thefootnotemark}\,#1}%
}

% Libertine in tabular
\makeatletter
\AtBeginDocument{\def\libertine@figurealign{}\libertineOsF}
\makeatother
\makeatletter
\newcommand\libertineTabular{\def\libertine@figurealign{T}\libertineLF}
\makeatother
\usepackage{etoolbox}
\AtBeginEnvironment{tabular}{\libertineTabular}
\AtBeginEnvironment{longtable}{\libertineTabular}

% KOMA font options
\setkomafont{descriptionlabel}{\normalfont\scshape\bfseries}


% KOMA options
\KOMAoptions{headings=standardclasses}
\KOMAoptions{DIV=last}


\begin{document}
\maketitle



{
\hypersetup{linkcolor=}
\setcounter{tocdepth}{2}
\tableofcontents
}



Section

\hypertarget{subsection}{%
\subsection{Subsection}\label{subsection}}

\hypertarget{sub-subsection}{%
\subsubsection{Sub-subsection}\label{sub-subsection}}

\hypertarget{heading-1}{%
\section{Heading 1}\label{heading-1}}

\hypertarget{heading-2}{%
\subsection{Heading 2}\label{heading-2}}

And some text

\ldots.

\end{document}

% This template has been adapted from https://github.com/jgm/pandoc-templates
% that comes attached with the following copyright notice. It also includes
% segments from the R Markdown template that in turn is based on the pandoc
% template.
%
% Copyright (c) 2014--2017, John MacFarlane
%
% All rights reserved.
%
% Redistribution and use in source and binary forms, with or without
% modification, are permitted provided that the following conditions are met:
%
% * Redistributions of source code must retain the above copyright notice,
%   this list of conditions and the following disclaimer.
% * Redistributions in binary form must reproduce the above copyright notice,
%   this list of conditions and the following disclaimer in the documentation
%   and/or other materials provided with the distribution.
% * Neither the name of John MacFarlane nor the names of other contributors may
%   be used to endorse or promote products derived from this software without
%   specific prior written permission.
%
% THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
% AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
% IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
% ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE
% LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
% CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
% SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
% INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
% CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
% ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
% POSSIBILITY OF SUCH DAMAGE.

\PassOptionsToPackage{unicode=true}{hyperref} % options for packages loaded elsewhere
\PassOptionsToPackage{hyphens}{url}
\PassOptionsToPackage{dvipsnames,svgnames*,x11names*}{xcolor}
%
\PassOptionsToPackage{font=small,
                      labelfont=bf,
                      labelsep=period,
                      justification=RaggedRight,
                      format=plain,
                      tableposition=top,
                      singlelinecheck=off}{caption}

\documentclass[%
numbers=noendperiod,
parskip=half,
bibliography=totoc,
,
]{scrartcl}

\usepackage{multicol}

% Margin paragraph
\usepackage{marginfix}
%\usepackage{morefloats} % More than 18 floats

\usepackage[font=footnotesize]{subcaption}
\usepackage{booktabs}
\usepackage[document]{ragged2e}
\usepackage[shortlabels]{enumitem}
\usepackage{etoolbox}
\usepackage{floatrow}
\usepackage{environ}
\usepackage{xspace}

\usepackage{ifxetex,ifluatex}


\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex

% Fonts

\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage{amsthm}
\usepackage[lining]{libertine}
\usepackage{textcomp}
\usepackage[scaled=0.96,varqu,varl]{inconsolata}
\usepackage{mathtools}
\usepackage[libertine,libaltvw,liby,vvarbb]{newtxmath}
\IfFileExists{mathalfa.sty}{\usepackage[scr=boondoxo]{mathalfa}}{}
\IfFileExists{bm.sty}{\usepackage{bm}}{}
\useosf

\else % if luatex or xelatex
  \usepackage{unicode-math}
  \defaultfontfeatures{Ligatures=TeX,Scale=MatchLowercase}
\fi

% use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
% use microtype if available
\IfFileExists{microtype.sty}{%
\usepackage[]{microtype}
\UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\IfFileExists{parskip.sty}{%
\usepackage{parskip}
}{% else
\setlength{\parindent}{0pt}
\setlength{\parskip}{6pt plus 2pt minus 1pt}
}
\usepackage{xcolor}
\usepackage{hyperref}
\usepackage{cleveref}
\hypersetup{
            pdftitle={komatufte},
            colorlinks=true,
            linkcolor=PineGreen,
            filecolor=PineGreen,
            citecolor=Periwinkle,
            urlcolor=NavyBlue,
            breaklinks=true}
\urlstyle{same}  % don't use monospace font for urls

% Set tufte-like page layout
\usepackage[
        a4paper,
  left=23mm,
  top=27.4mm,
  bottom=27.4mm,
  textwidth=107mm,
  marginparsep=8mm,
  marginparwidth=49mm]{geometry}

\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{longtable,booktabs}
% Fix footnotes in tables (requires footnote package)
\IfFileExists{footnote.sty}{\usepackage{footnote}\makesavenoteenv{longtable}}{}

\usepackage{graphicx,grffile}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}

\setlength{\emergencystretch}{3em}  % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{5}

% Redefines (sub)paragraphs to behave more like sections
\ifx\paragraph\undefined\else
\let\oldparagraph\paragraph
\renewcommand{\paragraph}[1]{\oldparagraph{#1}\mbox{}}
\fi
\ifx\subparagraph\undefined\else
\let\oldsubparagraph\subparagraph
\renewcommand{\subparagraph}[1]{\oldsubparagraph{#1}\mbox{}}
\fi

% set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother


\usepackage[]{biblatex}

% Block margins for caption around figure and table environments
\BeforeBeginEnvironment{figure}{\blockmargin}
\AfterEndEnvironment{figure}{\unblockmargin}
\BeforeBeginEnvironment{widefigure}{\blockmargin}
\AfterEndEnvironment{widefigure}{\unblockmargin}
\BeforeBeginEnvironment{table}{\blockmargin}
\AfterEndEnvironment{table}{\unblockmargin}
\BeforeBeginEnvironment{longtable}{\blockmargin}
\AfterEndEnvironment{longtable}{\unblockmargin}

% Algorithms
\IfFileExists{algpseudocode.sty}{%
\usepackage[noend]{algpseudocode}
\DeclareNewFloatType{algorithm}{fileext=alg, name=Algorithm}
\floatsetup[algorithm]{margins=hangright,
                       capposition=beside,
                       capbesidesep=marginparsep,
                       capbesideposition={top,right},
                       floatwidth=\textwidth}%
\BeforeBeginEnvironment{algorithm}{\blockmargin}
\AfterEndEnvironment{algorithm}{\unblockmargin}
}{}

% Floats
\DeclareNewFloatType{widefigure}{fileext=wfig, name=Figure}
\DeclareFloatSeparators{marginparsep}{\hskip\marginparsep}
\floatsetup[figure]{margins=hangright,
                    capposition=beside,
                    capbesidesep=marginparsep,
                    capbesideposition={top,right},
                    floatwidth=\textwidth}
\floatsetup[table]{margins=hangright,
                   capposition=beside,
                   capbesidesep=marginparsep,
                   capbesideposition={top,right},
                   floatwidth=\textwidth}
\floatsetup[longtable]{margins=hangright,
                       capposition=beside,
                       capbesidesep=marginparsep,
                       capbesideposition={top,right},
                       floatwidth=\textwidth}
\floatsetup[widefigure]{margins=hangright,
                        capposition=bottom}
\floatsetup[widetable]{margins=hangright,
                       capposition=top}
\captionsetup[subfigure]{position=b,justification=RaggedRight}
\captionsetup[sub]{justification=RaggedRight}

% Provide marginfigure
\NewEnviron{marginfigure}{%
  \marginpar{%
    \captionsetup{type=figure}
    \BODY
  }%
}

% Provide margintable
\NewEnviron{margintable}{%
  \marginpar{%
    \captionsetup{type=table}
    \BODY
  }%
}

% Extended verbatim environments
\usepackage{fancyvrb}
\fvset{fontsize=\small}% default font size for fancy-verbatim environments

% Provide fullwidth environment
\newlength{\overhang}
\setlength{\overhang}{\marginparwidth}
\addtolength{\overhang}{\marginparsep}

\newenvironment{fullwidth}{%
  \blockmargin
  \begin{addmargin*}[0em]{-\overhang}%
}{%
  \end{addmargin*}%
  \unblockmargin
}

% Use protect on footnotes to avoid problems with footnotes in titles
\let\rmarkdownfootnote\footnote%
\def\footnote{\protect\rmarkdownfootnote}

\usepackage{graphicx,grffile}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}

\title{komatufte}

\subtitle{Koma-script articles inspired by Tufte}

% Subfigs
%\usepackage[margin=1em]{subfig}

% Authors
\usepackage[noblocks]{authblk}
\renewcommand\Affilfont{\normalfont\itshape\small}
\renewcommand\Authfont{}

\author[]{Joey Trampush}


\date{2021-02-13}

% Headers and footers
\usepackage[headsepline=false,
                        headwidth=textwithmarginpar,
            footwidth=head]{scrlayer-scrpage}

\pagestyle{scrheadings}


\clearpairofpagestyles
\rofoot[\pagemark]{\pagemark}
\lohead{\headmark}



% New, custom title
\usepackage{titling}
\setlength{\droptitle}{-5em}
\pretitle{\begin{flushleft}\huge\bfseries\sffamily}
\posttitle{
    \\\smallskip\normalfont\itshape\large Koma-script articles inspired by Tufte
    \end{flushleft}
}
\preauthor{\begin{flushleft}\Large\scshape}
\postauthor{\end{flushleft}\normalfont}
\predate{\begin{flushleft}\large\itshape}
\postdate{\end{flushleft}}

% Captions
\usepackage[font=footnotesize]{subcaption}
%\captionsetup[sub]{font = footnotesize}


% Text justification and parskip
\usepackage[document]{ragged2e}

% Lists
\usepackage[shortlabels]{enumitem}

% Caption styles (caption package is loaded with sidenotes)
\DeclareCaptionStyle{sidecaption}{labelfont=bf,labelsep=period,font=small}
\DeclareCaptionStyle{marginfigure}{labelfont=bf,labelsep=period,font=small}
\DeclareCaptionStyle{margintable}{labelfont=bf,labelsep=period,font=small,position=top}
\DeclareCaptionStyle{widefigure}{labelfont=bf,labelsep=period,font=small}
\DeclareCaptionStyle{widetable}{labelfont=bf,labelsep=period,font=small}

% Redefine footnotes to be marginnotes
\newcounter{snmark}
\setcounter{snmark}{0}

\newcommand*{\makesidenotemark}{\/\textsuperscript{\thesnmark}}

\renewcommand{\footnote}[1]{%
  \refstepcounter{snmark}%
  \makesidenotemark{}%
  \marginpar{\RaggedRight\small\textsuperscript{\thesnmark}\,#1}%
}

% Put thanks in marginpar
\renewcommand{\thanks}[1]{%
  \footnotemark%
  \marginpar{\RaggedRight\small\textsuperscript{\thefootnotemark}\,#1}%
}

% Libertine in tabular
\makeatletter
\AtBeginDocument{\def\libertine@figurealign{}\libertineOsF}
\makeatother
\makeatletter
\newcommand\libertineTabular{\def\libertine@figurealign{T}\libertineLF}
\makeatother
\usepackage{etoolbox}
\AtBeginEnvironment{tabular}{\libertineTabular}
\AtBeginEnvironment{longtable}{\libertineTabular}

% KOMA font options


% KOMA options


\begin{document}
\maketitle



{
\hypersetup{linkcolor=}
\setcounter{tocdepth}{2}
\tableofcontents
}



\hypertarget{inspired-by-edward-tufte}{%
\section{Inspired by Edward Tufte}\label{inspired-by-edward-tufte}}

This style has been inspired by the popular document style of Edward Tufte, which is used throughout his many excellent texts on data visualization.
The distinguishing feature of this style is its division into a left-aligned main column and a wide margin on the right into which text, figures, tables, and more can be arranged.

Unlike the tufte package {[}Xie and Allaire, 2018{]}, however, komadown takes a bit of freedom with this design.\footnote{Instead of italic roman headings, for instance, we ahve opted for bodl sans serif.}
Unlike the scrartcl style that is also featured in this package, this template takes a much more opinionated approach to the design.
There are fewer options for customization
\footnote{It is not, however, unlikely this will change in teh fguture.}

\hypertarget{default-figure-environment}{%
\subsection{Default figure environment}\label{default-figure-environment}}

komatufte features three different figure environments.
The de- fault figure environment has the figure positioned in the main col- umn and figure caption in the margin.
Figure 1, taken from Paul Murrels excellent R Graphics {[}Murrell, 2011{]}, showcases the default behavior of figures in this template.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{z }\OtherTok{\textless{}{-}} \DecValTok{2} \SpecialCharTok{*}\NormalTok{ volcano}
\NormalTok{x }\OtherTok{\textless{}{-}} \DecValTok{10} \SpecialCharTok{*} \DecValTok{1}\SpecialCharTok{:}\FunctionTok{nrow}\NormalTok{(z) }
\NormalTok{y }\OtherTok{\textless{}{-}} \DecValTok{10} \SpecialCharTok{*} \DecValTok{1}\SpecialCharTok{:}\FunctionTok{ncol}\NormalTok{(z)}

\NormalTok{trans }\OtherTok{\textless{}{-}} \FunctionTok{persp}\NormalTok{(x, y, z, }\AttributeTok{zlim =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\FunctionTok{max}\NormalTok{(z)), }
               \AttributeTok{theta =} \DecValTok{150}\NormalTok{, }\AttributeTok{phi =} \DecValTok{12}\NormalTok{, }\AttributeTok{lwd =} \FloatTok{0.5}\NormalTok{,}
               \AttributeTok{scale =} \ConstantTok{FALSE}\NormalTok{, }\AttributeTok{axes =} \ConstantTok{FALSE}\NormalTok{)}

\NormalTok{f }\OtherTok{\textless{}{-}} \FunctionTok{Map}\NormalTok{(}\ControlFlowTok{function}\NormalTok{(i) }\FunctionTok{lines}\NormalTok{(}\FunctionTok{trans3d}\NormalTok{(i}\SpecialCharTok{$}\NormalTok{x, i}\SpecialCharTok{$}\NormalTok{y, }\DecValTok{0}\NormalTok{, trans)), }
         \FunctionTok{contourLines}\NormalTok{(x, y, z))}
\end{Highlighting}
\end{Shaded}

\includegraphics{koma_tufte_2_files/figure-latex/unnamed-chunk-2-1}

\hypertarget{margin-figures}{%
\subsection{Margin figures}\label{margin-figures}}

There is also the option to put figures, including caption, alto- gether into the margin.
This environment is invoked by specifying fig.env = ``marginfigure'' as a chunk option.
This environment is examplified in Figure 2.

\begin{Shaded}
\begin{Highlighting}[]
 \FunctionTok{mosaicplot}\NormalTok{(Survived }\SpecialCharTok{\textasciitilde{}}\NormalTok{ Sex }\SpecialCharTok{+}\NormalTok{ Age, }\AttributeTok{data =}\NormalTok{ Titanic, }\AttributeTok{shade =} \ConstantTok{TRUE}\NormalTok{, }\AttributeTok{main =} \StringTok{""}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{koma_tufte_2_files/figure-latex/unnamed-chunk-3-1}

\hypertarget{wide-figures}{%
\subsection{Wide figures}\label{wide-figures}}

The last figure environment is widefigure, enabled by setting fig.env = ``widefigure''.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{plot}\NormalTok{(Nile, }\AttributeTok{ylab =} \StringTok{"Flow"}\NormalTok{, }\AttributeTok{xlab =} \StringTok{""}\NormalTok{, }\AttributeTok{col =} \StringTok{"steelblue4"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{koma_tufte_2_files/figure-latex/unnamed-chunk-4-1}

\hypertarget{sub-subsection}{%
\subsubsection{Sub-subsection}\label{sub-subsection}}

\begin{fullwidth}
  \begin{multicols}{2}[\printbibheading]
    \renewcommand{\bibfont}{\small}
    \printbibliography[heading=none]
  \end{multicols}
\end{fullwidth}

\end{document}

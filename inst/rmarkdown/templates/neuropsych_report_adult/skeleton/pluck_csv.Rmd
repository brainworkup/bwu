---
title: "Pluck Additional Neuropsych Measures/Tests"
params:
  patient:
    label: "Patient First Name:"
    value: Biggie
    input: text
  test_name:
    label: "Full Name of Test/Test Battery:"
    value: NIH EXAMINER
    input: radio
    choices:
      - NIH EXAMINER
      - Grooved Pegboard
      - Rey Complex Figure
      - Test of Premorbid Functioning
      - Trail Making Test
      - D-KEFS Color-Word Interference
  test:
    label: "Test/Measure File Name:"
    value: examiner
    input: radio
    choices:
      - examiner
      - pegboard
      - rocf
      - topf
      - tmt
      - dkefs_cwi
  raw_data:
    label: "Test/Measure Raw Score File:"
    value: pre_examiner.csv
    input: radio
    choices:
      - pre_examiner.csv
      - pre_pegboard.csv
      - pre_rocf.csv
      - pre_topf.csv
      - pre_tmt.csv
      - pre_dkefs_cwi.csv
  score_type:
    label: "Type of Test Score:"
    value: t_score
    input: radio
    choices:
      - z_score
      - scaled_score
      - t_score
      - standard_score
  mean:
    label: "Mean:"
    value: 50
    input: radio
    choices: [0, 10, 50, 100]
  stdev:
    label: "Standard Deviation:"
    value: 10
    input: radio
    choices: [1, 3, 10, 15]
  reliability:
    label: "Reliability:"
    value: 0.80
    input: slider
    min: 0
    max: 1
    step: 0.01
  file:
    label: "Select Pre-CSV File"
    value: File
    input: file
output:
  rmdformats::robobook:
    highlight: kate
---

## Setup

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  root.dir = normalizePath("./"),
  echo = TRUE,
  message = FALSE,
  warning = FALSE,
  error = TRUE
)
library(bwu)
library(dplyr)
library(hablar)
library(here)
library(knitr)
library(magrittr)
library(readr)
library(rmarkdown)
library(shiny)
library(tibble)
library(tidyr)
library(vroom)
```

## Patient

```{r patient}
patient <- params$patient
```

## Test

```{r test}
test <- params$test
```

## Raw Data

```{r raw}
raw_data <- params$raw_data
```

## Import csv

```{r read}
table <- readr::read_csv(here::here(patient, "pre_csv", raw_data))
```

## Convert z/ss/T/SS scores to percentiles and glue result

```{r convert}
table <- bwu::gpluck_t2z2p(
  table = table,
  score = score,
  score_type = params$score_type
)
```

## Compute CI 95%

```{r ci}
table$ci_95 <- bwu::ci(
  x = as.numeric(table$score),
  m = as.numeric(params$mean),
  sd = as.numeric(params$stdev),
  rel = as.numeric(params$reliability)
)
```

## Write out

### RDS

```{r saverds}
saveRDS(
  table,
  file = here::here(patient, "csv", paste0(test, ".rds")),
  compress = FALSE
)
```

### CSV

```{r writeout}
readr::write_csv(
  table,
  here::here(patient, "csv", paste0(test, ".csv")),
  col_names = TRUE,
  na = ""
)
```

---
format:
  neurotyp-typst:
    keep-typ: true
params:
  first_name: NULL
  his_her: NULL
  he_she: NULL
  he_she_cap: NULL
  his_her_cap: NULL
  him_her: NULL
  him_her_cap: NULL
---

# Emotional/Behavioral/Personality {#sec-emotion}

{{< include _02-10_emotion_text.qmd >}}

```{r}
#| label: data-emotion
library(bwu)
pheno <- "emotion"
data <- bwu::read_data(pheno = pheno)
domains <- c(
  "Psychiatric Disorders", "Personality Disorders", "Substance Use",
  "Psychosocial Problems"
)
scales <- c(
  "Activity Level",
  "Affective (A)",
  "Affective (D)",
  "Affective Instability",
  "Aggression",
  "Aggressive Attitude",
  "ALC Estimated Score",
  "Alcohol Problems",
  "Antisocial Behaviors",
  "Antisocial Features",
  "Anxiety-Related Disorders",
  "Anxiety",
  "BAI-2 Total Score",
  "BID-2 Total Score",
  "Borderline Features",
  "Cognitive (A)",
  "Cognitive (D)",
  "Conversion",
  "Depression",
  "Dominance",
  "DRG Estimated Score",
  "Drug Problems",
  "Egocentricity",
  "Grandiosity",
  "Health Concerns",
  "Hypervigilance",
  "Identity Problems",
  "Irritability",
  "Mania",
  "Negative Relationships",
  "Nonsupport",
  "Obsessive-Compulsive",
  "Paranoia",
  "Persecution",
  "Phobias",
  "Physical Aggression",
  "Physiological (A)",
  "Physiological (D)",
  "Psychotic Experiences",
  "Resentment",
  "Schizophrenia",
  "Self-Harm",
  "Social Detachment",
  "Somatic Complaints",
  "Somatization",
  "Stimulus-Seeking",
  "Stress",
  "Suicidal Ideation",
  "Thought Disorder",
  "Traumatic Stress",
  "Treatment Rejection",
  "Verbal Aggression",
  "Warmth"
  # ADD BASC3 SRP
)
data <-
  bwu::filter_data(
    data,
    domain = domains,
    scale = scales
)
```

```{r}
#| label: text-emotion
#| cache: true
bwu::cat_neuropsych_results(data = data, file = "_02-10_emotion_text.qmd")
```

```{r}
#| label: qtbl-emotion
#| dev: tikz
#| fig-process: pdf2png
#| eval: true
options(tikzDefaultEngine = "xetex")

# footnotes
# fn_standard_score <- gt::md("Standard Score: Mean = 100 [50th‰], SD ± 15 [16th‰, 84th‰]")
fn_t_score <- gt::md("*T* Score: Mean = 50 [50th‰], SD ± 10 [16th‰, 84th‰]")
# fn_scaled_score <- gt::md("Scaled Score: Mean = 10 [50th‰], SD ± 3 [16th‰, 84th‰]")
# fn_z_score <- gt::md("*z* Score: Mean = 0 [50th‰], SD ± 1 [16th‰, 84th‰]")

pheno <- "emotion"
table_name <- "table_emotion"
grp_emotion <- list(
  t_score = c("PAI", "BASC-3 PRS", "BASC-3 SRP", "BASC-3 TRS")
)
vertical_padding <- 0.05

data2 <-
  dplyr::filter(data, domain %in% c(
    "Psychiatric Disorders",
    "Personality Disorders", "Substance Use"
  )) |>
  dplyr::arrange(test_name) |>
  dplyr::arrange(subdomain)

data_emotion <- data2[, c(10, 1, 3, 4, 5)]
colnames(data_emotion)[1] <- "test_name"
data3 <- data_emotion

bwu::tbl_gt(
  data = data3,
  pheno = pheno,
  table_name = table_name,
  dynamic_grp = grp_emotion,
  vertical_padding = vertical_padding,
  multiline = FALSE
)
```

```{r}
#| eval: false

tbl1 <-
  dplyr::filter(data_emotion, domain == "Psychiatric Disorders") |>
  dplyr::arrange(test_name) |>
  dplyr::arrange(subdomain)
tbl1 <- tbl1[, c(11, 2, 4, 5, 6)]
colnames(tbl1)[1] <- "test_name"
table_psych <- bwu::tbl_gt(
  tbl1,
  table_name = "table_psych",
  source_note = source_note
)

tbl2 <-
  dplyr::filter(data_emotion, domain == "Personality Disorders") |>
  dplyr::arrange(test_name) |>
  dplyr::arrange(subdomain)
tbl2 <- tbl2[, c(11, 2, 4, 5, 6)]
colnames(tbl2)[1] <- "test_name"
table_personality <- bwu::tbl_gt(
  tbl2,
  table_name = "table_personality",
  source_note = source_note
)

tbl3 <-
  dplyr::filter(data_emotion, domain == "Substance Use") |>
  dplyr::arrange(test_name) |>
  dplyr::arrange(subdomain)
tbl3 <- tbl3[, c(11, 2, 4, 5, 6)]
colnames(tbl3)[1] <- "test_name"
table_sud <- bwu::tbl_gt(
  tbl3,
  table_name = "table_sud",
  source_note = source_note
)

tbl4 <-
  dplyr::filter(data_emotion, domain == "Psychosocial Problems") |>
  dplyr::arrange(test_name) |>
  dplyr::arrange(subdomain)
tbl4 <- tbl4[, c(11, 2, 4, 5, 6)]
colnames(tbl4)[1] <- "test_name"
table_social <- bwu::tbl_gt(
  tbl4,
  table_name = "table_social",
  source_note = source_note
)
```

```{r}
#| label: fig-emotion
#| fig-cap: "Mood/Self-Report"

# Arguments
pheno <- "emotion"
emotion <-
  dplyr::filter(data) |>
  dplyr::filter(domain %in% c("Psychiatric Disorders", "Personality Disorders", "Substance Use"))

data <- emotion
x <- data$z_mean_subdomain
y <- data$subdomain
colors <- NULL
return_plot <- TRUE
# return_plot <- Sys.getenv("RETURN_PLOT")
filename <- "fig_emotion.svg"

# Make dotplot
bwu::dotplot(
  data = data,
  x = x,
  y = y,
  colors = colors,
  return_plot = return_plot,
  filename = filename
)
```

```{=typst}
#let domain_emotion(file_fig) = {
  let font = (font: "Fira Sans", size: 9pt)
  set text(..font)
figure([#image(file_fig, width: auto)],
  placement: none,
  caption: [Emotional/Behavioral/Personality],
  caption-pos: bottom,
  kind: "image",
  supplement: [*Fig.*],
  gap: 0.5em,
  )
}
```

```{=typst}
#let file_fig = "_02-10_emotion_files/figure-typst/fig-emotion-1.svg"
#domain_emotion(
  file_fig
)
```

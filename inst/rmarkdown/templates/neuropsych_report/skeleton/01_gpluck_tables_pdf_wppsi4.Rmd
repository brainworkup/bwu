---
title: "GPluck Tables from PDFs: WPPSI-IV"
---

# WPPSI-IV

```{r}
Sys.setenv(JAVA_HOME = "/Library/Java/JavaVirtualMachines/temurin-11.jdk/Contents/Home")
```

```{r}
Sys.setenv(DYLD_LIBRARY_PATH = "Library/Java/JavaVirtualMachines/temurin-11.jdk/Contents/Home/lib/server")
```

## Patient

```{r patient}
patient <- "Biggie"
```

## Load libraries

```{r setup, include=FALSE}
library(knitr)
library(xfun)
knitr::opts_chunk$set(
  root.dir = normalizePath("./"),
  echo = FALSE,
  eval = TRUE,
  message = FALSE,
  warning = FALSE,
  error = TRUE
)
library(tabulapdf)
library(rJava)
library(shiny)
library(miniUI)
library(here)
library(pdftools)
library(tidyverse)
library(fs)
library(magrittr)
library(kableExtra)
library(formattable)
library(DT)
library(ggiraph)
library(hablar)
library(jdx)
```

## Load functions

```{r gpluck-locate-areas}
source(file = here::here("R/gpluck_locate_areas.R"), local = knitr::knit_global())
```

```{r gpluck-extract-table}
source(file = here::here("R/gpluck_extract_table.R"), local = knitr::knit_global())
```

```{r gpluck-make-columns}
source(file = here::here("R/gpluck_make_columns.R"), local = knitr::knit_global())
```

```{r gpluck-make-score-ranges}
source(file = here::here("R/gpluck_make_score_ranges.R"), local = knitr::knit_global())
```

## File choose

```{r pdf}
cognitive_pdf <- file.choose()
```

# tabulapdf

Need to check each PDF to see what page(s) tables are located on.

## Locate areas

Change pages per patient.

```{r locate-areas}
area <- gpluck_locate_areas(
  file = cognitive_pdf,
  pages = c(3, 6, 2, 6)
)
```

## Extract table

Change pages per patient.

```{r extract-table}
table <- gpluck_extract_table(
  file = cognitive_pdf,
  pages = c(3, 6, 2, 6),
  area = area,
  guess = NULL,
  method = "stream",
  output = "matrix"
)
```

# Format

## Column names

This will vary by measure/table.

```{r colnames1}
column_names1 <- c(
  "scale",
  "abbrev",
  "raw_score",
  "score",
  "percentile",
  "ci_95",
  "category",
  "sem"
)
```

```{r colnames2}
column_names2 <- c(
  "scale",
  "abbrev",
  "raw_score",
  "score",
  "percentile",
  "age_equiv",
  "sem"
)
```

## Convert to tibble and format

```{r to-tibble1}
table1 <- as_tibble(table[[1]])
colnames(table1) <- column_names1
table1 <- dplyr::na_if(table1, "")
table1 <- dplyr::na_if(table1, "NA")
table1 <- dplyr::na_if(table1, "-")
table1 <- dplyr::na_if(table1, "--")
table1 <- dplyr::na_if(table1, "---")
to_double <- c("raw_score", "score", "percentile")
table1 <- table1 |> hablar::convert(dbl(all_of(to_double)))
```

```{r to-tibble2}
table2 <- as_tibble(table[[2]])
colnames(table2) <- column_names1
table2 <- dplyr::na_if(table2, "")
table2 <- dplyr::na_if(table2, "NA")
table2 <- dplyr::na_if(table2, "-")
table2 <- dplyr::na_if(table2, "--")
table2 <- dplyr::na_if(table2, "---")
to_double <- c("raw_score", "score", "percentile")
table2 <- table2 |> hablar::convert(dbl(all_of(to_double)))
```

```{r to-tibble3}
table3 <- as_tibble(table[[3]])
colnames(table3) <- column_names2
table3 <- dplyr::na_if(table3, "")
table3 <- dplyr::na_if(table3, "NA")
table3 <- dplyr::na_if(table3, "-")
table3 <- dplyr::na_if(table3, "--")
table3 <- dplyr::na_if(table3, "---")
to_double <- c("raw_score", "score", "percentile")
table3 <- table3 |> hablar::convert(dbl(all_of(to_double)))
```

```{r to-tibble4}
table4 <- as_tibble(table[[4]])
colnames(table4) <- column_names2
table4 <- dplyr::na_if(table4, "")
table4 <- dplyr::na_if(table4, "NA")
table4 <- dplyr::na_if(table4, "-")
table4 <- dplyr::na_if(table4, "--")
table4 <- dplyr::na_if(table4, "---")
to_double <- c("raw_score", "score", "percentile")
table4 <- table4 |> hablar::convert(dbl(all_of(to_double)))
```

## Select variables to keep

This will vary by measure.

```{r keep}
keep1 <- c("scale", "raw_score", "score", "percentile", "ci_95")
keep2 <- c("scale", "raw_score", "score", "percentile")
```

```{r keep-select}
table1 <- table1 |> dplyr::select(all_of(keep1))
table2 <- table2 |> dplyr::select(all_of(keep1))
table3 <- table3 |> dplyr::select(all_of(keep2))
table4 <- table4 |> dplyr::select(all_of(keep2))
```

## Row names

As necessary.

```{r rownames1}
table1[1, 1] <- c("Verbal Comprehension (VCI)")
table1[2, 1] <- c("Visual Spatial (VSI)")
table1[3, 1] <- c("Fluid Reasoning (FRI)")
table1[4, 1] <- c("Working Memory (WMI)")
table1[5, 1] <- c("Processing Speed (PSI)")
table1[6, 1] <- c("Full Scale IQ (FSIQ)")
```

```{r rownames2}
table2[1, 1] <- c("Vocabulary Acquisition (VAI)")
table2[2, 1] <- c("Nonverbal (NVI)")
table2[3, 1] <- c("General Ability (GAI)")
table2[4, 1] <- c("Cognitive Proficiency (CPI)")
```

```{r rownames3}
table3[3, 1] <- c("Vocabulary")
table3[4, 1] <- c("Comprehension")
table3[13, 1] <- c("Animal Coding")
```

# Mutate

## Make columns

```{r mutate1}
table1 <- gpluck_make_columns(
  table1,
  range = NA,
  test = "wppsi4",
  test_name = "WPPSI-IV",
  domain = "Intelligence/General Ability",
  subdomain = NA,
  narrow = NA,
  pass = NA,
  verbal = NA,
  timed = NA,
  test_type = "npsych_test",
  score_type = "standard_score",
  description = NA
)
```

```{r mutate2}
table2 <- gpluck_make_columns(
  table2,
  range = NA,
  test = "wppsi4",
  test_name = "WPPSI-IV",
  domain = "Intelligence/General Ability",
  subdomain = "",
  narrow = "",
  timed = "",
  verbal = "",
  pass = "",
  test_type = "npsych_test",
  score_type = "standard_score",
  description = ""
)
```

```{r mutate3}
table3 <- gpluck_make_columns(
  table3,
  range = "",
  ci_95 = "",
  test = "wppsi4",
  test_name = "WPPSI-IV",
  domain = "",
  subdomain = "",
  narrow = "",
  timed = "",
  verbal = "",
  pass = "",
  test_type = "npsych_test",
  score_type = "scaled_score",
  description = ""
)
```

```{r mutate4}
table4 <- gpluck_make_columns(
  table4,
  range = "",
  ci_95 = "",
  test = "wppsi4",
  test_name = "WPPSI-IV",
  domain = "",
  subdomain = "",
  narrow = "",
  timed = "",
  verbal = "",
  pass = "",
  test_type = "npsych_test",
  score_type = "scaled_score",
  description = ""
)
```

## Test score ranges

```{r range}
table1 <- gpluck_make_score_ranges(table = table1)
table2 <- gpluck_make_score_ranges(table = table2)
table3 <- gpluck_make_score_ranges(table = table3)
table4 <- gpluck_make_score_ranges(table = table4)
```

## Domain

As necessary.

```{r domain1}
table1 <-
  table1 |>
  mutate(
    domain = case_when(
      scale == "Verbal Comprehension (VCI)" ~ "Intelligence/General Ability",
      scale == "Visual Spatial (VSI)" ~ "Intelligence/General Ability",
      scale == "Fluid Reasoning (FRI)" ~ "Intelligence/General Ability",
      scale == "Working Memory (WMI)" ~ "Intelligence/General Ability",
      scale == "Processing Speed (PSI)" ~ "Intelligence/General Ability",
      scale == "Full Scale IQ (FSIQ)" ~ "Intelligence/General Ability",
      TRUE ~ as.character(domain)
    )
  )
```

```{r domain2}
table2 <-
  table2 |>
  mutate(
    domain = case_when(
      scale == "Vocabulary Acquisition (VAI)" ~ "Intelligence/General Ability",
      scale == "Nonverbal (NVI)" ~ "Intelligence/General Ability",
      scale == "General Ability (GAI)" ~ "Intelligence/General Ability",
      scale == "Cognitive Proficiency (CPI)" ~ "Intelligence/General Ability",
      TRUE ~ as.character(domain)
    )
  )
```

```{r domain3}
table3 <-
  table3 |>
  mutate(
    domain = case_when(
      scale == "Information" ~ "Verbal/Language",
      scale == "Similarities" ~ "Verbal/Language",
      scale == "Vocabulary" ~ "Verbal/Language",
      scale == "Comprehension" ~ "Verbal/Language",
      scale == "Block Design" ~ "Visual Perception/Construction",
      scale == "Object Assembly" ~ "Visual Perception/Construction",
      scale == "Matrix Reasoning" ~ "Visual Perception/Construction",
      scale == "Picture Concepts" ~ "Visual Perception/Construction",
      scale == "Picture Memory" ~ "Attention/Executive",
      scale == "Zoo Locations" ~ "Attention/Executive",
      scale == "Bug Search" ~ "Attention/Executive",
      scale == "Cancellation" ~ "Attention/Executive",
      scale == "Animal Coding" ~ "Attention/Executive",
      TRUE ~ as.character(domain)
    )
  )
```

```{r domain4}
table4 <-
  table4 |>
  mutate(
    domain = case_when(
      scale == "Receptive Vocabulary" ~ "Verbal/Language",
      scale == "Picture Naming" ~ "Verbal/Language",
      scale == "Cancellation Random" ~ "Attention/Executive",
      scale == "Cancellation Structured" ~ "Attention/Executive",
      TRUE ~ as.character(domain)
    )
  )
```

## Subdomain

As necessary.

```{r subdomain1}
table1 <-
  table1 |>
  mutate(
    subdomain = case_when(
      scale == "Verbal Comprehension (VCI)" ~ "Crystallized Intelligence",
      scale == "Visual Spatial (VSI)" ~ "Fluid Intelligence",
      scale == "Fluid Reasoning (FRI)" ~ "Fluid Intelligence",
      scale == "Working Memory (WMI)" ~ "Working Memory",
      scale == "Processing Speed (PSI)" ~ "Processing Speed",
      scale == "Full Scale IQ (FSIQ)" ~ "General Intelligence",
      TRUE ~ as.character(subdomain)
    )
  )
```

```{r subdomain2}
table2 <-
  table2 |>
  mutate(
    subdomain = case_when(
      scale == "Vocabulary Acquisition (VAI)" ~ "Crystallized Intelligence",
      scale == "Nonverbal (NVI)" ~ "Fluid Intelligence",
      scale == "General Ability (GAI)" ~ "General Ability",
      scale == "Cognitive Proficiency (CPI)" ~ "Cognitive Proficiency",
      TRUE ~ as.character(subdomain)
    )
  )
```

```{r subdomain3}
table3 <-
  table3 |>
  mutate(
    subdomain = case_when(
      scale == "Information" ~ "Verbal Reasoning",
      scale == "Similarities" ~ "Verbal Reasoning",
      scale == "Vocabulary" ~ "Verbal Reasoning",
      scale == "Comprehension" ~ "Verbal Reasoning",
      scale == "Block Design" ~ "Spatial Reasoning",
      scale == "Object Assembly" ~ "Spatial Reasoning",
      scale == "Matrix Reasoning" ~ "Fluid Reasoning",
      scale == "Picture Concepts" ~ "Fluid Reasoning",
      scale == "Picture Memory" ~ "Working Memory",
      scale == "Zoo Locations" ~ "Working Memory",
      scale == "Bug Search" ~ "Processing Speed",
      scale == "Cancellation" ~ "Processing Speed",
      scale == "Animal Coding" ~ "Processing Speed",
      TRUE ~ as.character(subdomain)
    )
  )
```

```{r subdomain4}
table4 <-
  table4 |>
  mutate(
    subdomain = case_when(
      scale == "Receptive Vocabulary" ~ "Verbal Reasoning",
      scale == "Picture Naming" ~ "Verbal Reasoning",
      scale == "Cancellation Random" ~ "Processing Speed",
      scale == "Cancellation Structured" ~ "Processing Speed",
      TRUE ~ as.character(subdomain)
    )
  )
```

## Narrow subdomain

As necessary.

```{r narrow1}
table1 <-
  table1 |>
  mutate(
    narrow = case_when(
      scale == "Verbal Comprehension (VCI)" ~ "Crystallized Intelligence",
      scale == "Visual Spatial (VSI)" ~ "Fluid Intelligence",
      scale == "Fluid Reasoning (FRI)" ~ "Fluid Intelligence",
      scale == "Working Memory (WMI)" ~ "Working Memory",
      scale == "Processing Speed (PSI)" ~ "Processing Speed",
      scale == "Full Scale IQ (FSIQ)" ~ "General Intelligence",
      TRUE ~ as.character(narrow)
    )
  )
```

```{r narrow2}
table2 <-
  table2 |>
  mutate(
    narrow = case_when(
      scale == "Vocabulary Acquisition (VAI)" ~ "Crystallized Intelligence",
      scale == "Nonverbal (NVI)" ~ "Fluid Intelligence",
      scale == "General Ability (GAI)" ~ "General Ability",
      scale == "Cognitive Proficiency (CPI)" ~ "Cognitive Proficiency",
      TRUE ~ as.character(narrow)
    )
  )
```

```{r narrow3}
table3 <-
  table3 |>
  mutate(
    narrow = case_when(
      scale == "Information" ~ "Acquired Knowledge",
      scale == "Similarities" ~ "Word Reasoning",
      scale == "Vocabulary" ~ "Word Knowledge",
      scale == "Comprehension" ~ "Knowledge/Judgment",
      scale == "Block Design" ~ "Visuomotor Integration",
      scale == "Object Assembly" ~ "Visuoconstruction",
      scale == "Matrix Reasoning" ~ "Inductive Reasoning",
      scale == "Picture Concepts" ~ "Spatial Reasoning",
      scale == "Picture Memory" ~ "Nonverbal Working Memory",
      scale == "Zoo Locations" ~ "Nonverbal Working Memory",
      scale == "Bug Search" ~ "Processing Speed",
      scale == "Cancellation" ~ "Visual Attention",
      scale == "Animal Coding" ~ "Processing Speed",
      TRUE ~ as.character(narrow)
    )
  )
```

```{r narrow4}
table4 <-
  table4 |>
  mutate(
    narrow = case_when(
      scale == "Receptive Vocabulary" ~ "Receptive Vocabulary",
      scale == "Picture Naming" ~ "Expressive Vocabulary",
      scale == "Cancellation Random" ~ "Visual Attention",
      scale == "Cancellation Structured" ~ "Visual Attention",
      TRUE ~ as.character(narrow)
    )
  )
```

## PASS model

As necessary.

```{r pass1}
table1 <-
  table1 |>
  mutate(
    pass = case_when(
      scale == "Verbal Comprehension (VCI)" ~ "Sequential",
      scale == "Visual Spatial (VSI)" ~ "Simultaneous",
      scale == "Fluid Reasoning (FRI)" ~ "Simultaneous",
      scale == "Working Memory (WMI)" ~ "Attention",
      scale == "Processing Speed (PSI)" ~ "Planning",
      scale == "Full Scale IQ (FSIQ)" ~ "PASS Total",
      TRUE ~ as.character(pass)
    )
  )
```

```{r pass2}
table2 <-
  table2 |>
  mutate(
    pass = case_when(
      scale == "Vocabulary Acquisition (VAI)" ~ "Sequential",
      scale == "Nonverbal (NVI)" ~ "Simultaneous",
      scale == "General Ability (GAI)" ~ "Sequential/Simultaneous",
      scale == "Cognitive Proficiency (CPI)" ~ "Attention/Planning",
      TRUE ~ as.character(pass)
    )
  )
```

```{r pass3}
table3 <-
  table3 |>
  mutate(
    pass = case_when(
      scale == "Information" ~ "Sequential",
      scale == "Similarities" ~ "Sequential",
      scale == "Vocabulary" ~ "Sequential",
      scale == "Comprehension" ~ "Sequential",
      scale == "Block Design" ~ "Simultaneous",
      scale == "Object Assembly" ~ "Simultaneous",
      scale == "Matrix Reasoning" ~ "Simultaneous",
      scale == "Picture Concepts" ~ "Simultaneous",
      scale == "Picture Memory" ~ "Attention",
      scale == "Zoo Locations" ~ "Attention",
      scale == "Bug Search" ~ "Planning",
      scale == "Cancellation" ~ "Attention",
      scale == "Animal Coding" ~ "Planning",
      TRUE ~ as.character(pass)
    )
  )
```

```{r pass4}
table4 <-
  table4 |>
  mutate(
    pass = case_when(
      scale == "Receptive Vocabulary" ~ "Simultaneous",
      scale == "Picture Naming" ~ "Simultaneous",
      scale == "Cancellation Random" ~ "Attention",
      scale == "Cancellation Structured" ~ "Attention",
      TRUE ~ as.character(pass)
    )
  )
```

## Verbal vs Nonverbal

As necessary.

```{r verbal1}
table1 <-
  table1 |>
  mutate(
    verbal = case_when(
      scale == "Verbal Comprehension (VCI)" ~ "Verbal",
      scale == "Visual Spatial (VSI)" ~ "Nonverbal",
      scale == "Fluid Reasoning (FRI)" ~ "Nonverbal",
      scale == "Working Memory (WMI)" ~ "Verbal",
      scale == "Processing Speed (PSI)" ~ "Nonverbal",
      scale == "Full Scale IQ (FSIQ)" ~ "Verbal/Nonverbal",
      TRUE ~ as.character(verbal)
    )
  )
```

```{r verbal2}
table2 <-
  table2 |>
  mutate(
    verbal = case_when(
      scale == "Vocabulary Acquisition (VAI)" ~ "Verbal",
      scale == "Nonverbal (NVI)" ~ "Nonverbal",
      scale == "General Ability (GAI)" ~ "Verbal/Nonverbal",
      scale == "Cognitive Proficiency (CPI)" ~ "Verbal/Nonverbal",
      TRUE ~ as.character(verbal)
    )
  )
```

```{r verbal3}
table3 <-
  table3 |>
  mutate(
    verbal = case_when(
      scale == "Information" ~ "Verbal",
      scale == "Similarities" ~ "Verbal",
      scale == "Vocabulary" ~ "Verbal",
      scale == "Comprehension" ~ "Verbal",
      scale == "Block Design" ~ "Nonverbal",
      scale == "Object Assembly" ~ "Nonverbal",
      scale == "Matrix Reasoning" ~ "Nonverbal",
      scale == "Picture Concepts" ~ "Nonverbal",
      scale == "Picture Memory" ~ "Nonverbal",
      scale == "Zoo Locations" ~ "Nonverbal",
      scale == "Bug Search" ~ "Nonverbal",
      scale == "Cancellation" ~ "Nonverbal",
      scale == "Animal Coding" ~ "Nonverbal",
      TRUE ~ as.character(verbal)
    )
  )
```

```{r verbal4}
table4 <-
  table4 |>
  mutate(
    verbal = case_when(
      scale == "Receptive Vocabulary" ~ "Verbal",
      scale == "Picture Naming" ~ "Verbal",
      scale == "Cancellation Random" ~ "Nonverbal",
      scale == "Cancellation Structured" ~ "Nonverbal",
      TRUE ~ as.character(verbal)
    )
  )
```

## Timed vs Untimed

As necessary.

```{r timed1}
table1 <-
  table1 |>
  mutate(
    timed = case_when(
      scale == "Verbal Comprehension (VCI)" ~ "FALSE",
      scale == "Visual Spatial (VSI)" ~ "TRUE",
      scale == "Fluid Reasoning (FRI)" ~ "FALSE",
      scale == "Working Memory (WMI)" ~ "FALSE",
      scale == "Processing Speed (PSI)" ~ "TRUE",
      scale == "Full Scale IQ (FSIQ)" ~ "TRUE",
      TRUE ~ as.character(timed)
    )
  )
```

```{r timed2}
table2 <-
  table2 |>
  mutate(
    timed = case_when(
      scale == "Vocabulary Acquisition (VAI)" ~ "FALSE",
      scale == "Nonverbal (NVI)" ~ "TRUE",
      scale == "General Ability (GAI)" ~ "FALSE",
      scale == "Cognitive Proficiency (CPI)" ~ "TRUE",
      TRUE ~ as.character(timed)
    )
  )
```

```{r timed3}
table3 <-
  table3 |>
  mutate(
    timed = case_when(
      scale == "Information" ~ "FALSE",
      scale == "Similarities" ~ "FALSE",
      scale == "Vocabulary" ~ "FALSE",
      scale == "Comprehension" ~ "FALSE",
      scale == "Block Design" ~ "TRUE",
      scale == "Object Assembly" ~ "TRUE",
      scale == "Matrix Reasoning" ~ "FALSE",
      scale == "Picture Concepts" ~ "FALSE",
      scale == "Picture Memory" ~ "FALSE",
      scale == "Zoo Locations" ~ "FALSE",
      scale == "Bug Search" ~ "TRUE",
      scale == "Cancellation" ~ "TRUE",
      scale == "Animal Coding" ~ "TRUE",
      TRUE ~ as.character(timed)
    )
  )
```

```{r timed4}
table4 <-
  table4 |>
  mutate(
    timed = case_when(
      scale == "Receptive Vocabulary" ~ "FALSE",
      scale == "Picture Naming" ~ "FALSE",
      scale == "Cancellation Random" ~ "TRUE",
      scale == "Cancellation Structured" ~ "TRUE",
      TRUE ~ as.character(timed)
    )
  )
```

### Description

As necessary.

```{r description1}
table1 <-
  table1 |>
  mutate(
    description = case_when(
      scale == "Verbal Comprehension (VCI)" ~ "verbal concept formation, verbal reasoning, verbal comprehension and expression, acquired knowledge, and practical knowledge and judgment",
      scale == "Visual Spatial (VSI)" ~ "ability to evaluate visual details, understand spatial relations among objects, and construct geometric designs using models",
      scale == "Fluid Reasoning (FRI)" ~ "ability to use reasoning to identify and apply solutions to problems",
      scale == "Working Memory (WMI)" ~ "ability to consciously register, maintain, and manipulate auditory and visual information",
      scale == "Processing Speed (PSI)" ~ "ability to quickly use reasoning to identify and apply solutions to problems",
      scale == "Full Scale IQ (FSIQ)" ~ "general intellectual ability",
      TRUE ~ as.character(description)
    )
  )
```

```{r description2}
table2 <-
  table2 |>
  mutate(
    description = case_when(
      scale == "Vocabulary Acquisition (VAI)" ~ "vocabulary acquisition and development",
      scale == "Nonverbal (NVI)" ~ "general intellectual functioning that minimizes expressive language demands",
      scale == "General Ability (GAI)" ~ "a subset of intellectual functioning with reduced influences of working memory and processing speed",
      scale == "Cognitive Proficiency (CPI)" ~ "index of cognitive processing proficiency that reduces crystallized knowledge, verbal reasoning, and fluid reasoning demands",
      TRUE ~ as.character(description)
    )
  )
```

```{r description3}
table3 <-
  table3 |>
  mutate(
    description = case_when(
      scale == "Information" ~ "acquired knowledge/ability to acquire, retain, and retrieve general factual knowledge",
      scale == "Similarities" ~ "verbal concept formation and abstract reasoning",
      scale == "Vocabulary" ~ "verbal concept formation and word knowledge",
      scale == "Comprehension" ~ "practical knowledge and judgment of general principles and social situations",
      scale == "Block Design" ~ "analyze and synthesize abstract visual stimuli",
      scale == "Object Assembly" ~ "visual-spatial processing and visual-motor integration",
      scale == "Matrix Reasoning" ~ "fluid intelligence, classificaiton and spatial ability, and simultaneous processing",
      scale == "Picture Concepts" ~ "fluid and inductive reasoning, and conceptual thinking",
      scale == "Picture Memory" ~ "visual/nonverbal working memory and working memory capacity",
      scale == "Zoo Locations" ~ "visual-spatial working memory",
      scale == "Bug Search" ~ "processing speed, attention, and concentration",
      scale == "Cancellation" ~ "rate of test-taking, perceptual speed, visual discrimination, and visual attention/scanning",
      scale == "Animal Coding" ~ "visual-motor processing speed",
      TRUE ~ as.character(description)
    )
  )
```

```{r description4}
table4 <-
  table4 |>
  mutate(
    description = case_when(
      scale == "Receptive Vocabulary" ~ "receptive language ability and vocabulary development",
      scale == "Picture Naming" ~ "expressive language ability and acquired knowledge",
      scale == "Cancellation Random" ~ "rate of test-taking, perceptual speed, visual discrimination, and visual attention/scanning (random)",
      scale == "Cancellation Structured" ~ "rate of test-taking, perceptual speed, visual discrimination, and visual attention/scanning (structured)",
      TRUE ~ as.character(description)
    )
  )
```

# Finalize

## Relocate variables

```{r}
table1 <- table1 |> relocate(c(raw_score, score, percentile, range, ci_95), .before = test)
table2 <- table2 |> relocate(c(raw_score, score, percentile, range, ci_95), .before = test)
table3 <- table3 |> relocate(c(raw_score, score, percentile, range, ci_95), .before = test)
table4 <- table4 |> relocate(c(raw_score, score, percentile, range, ci_95), .before = test)
```

## Keep/rename areas and tables

This might be an unnecessary step.

```{r rename}
area_table1 <- area[[1]]
wppsi4_table1 <- table1
area_table2 <- area[[2]]
wppsi4_table2 <- table2
area_table3 <- area[[3]]
wppsi4_table3 <- table3
area_table4 <- area[[4]]
wppsi4_table4 <- table4
```

## Merge tables

```{r rbind}
wppsi4 <- bind_rows(table1, table2, table3, table4)
```

## Write out final csv

```{r write-csv}
write_csv(wppsi4, here::here(patient, "csv", "wppsi4.csv"), col_names = TRUE, na = "")
```

## Cleanup

```{r cleanup}
# rm(area)
# rm(table)
# rm(table1, table2, table3, table4)
```

---
format:
  neurotyp-typst:
    keep-typ: true
params:
  pheno: "adaptive"
---

## Adaptive Functioning

{{< include _02-11_adaptive_text.qmd >}}

```{r}
#| label: data-adaptive
library(tidyverse)
library(gt)
library(gtExtras)
library(glue)
library(bwu)
data <- bwu::read_data(pheno = "adaptive")
domains <- c("Adaptive")
scales <- c(TODO:

)
data <- bwu::filter_data(data, domain = domains, scale = scales)
```

```{r}
#| label: text-adaptive
#| cache: true
bwu::cat_neuropsych_results(data, file = "_02-11_adaptive_text.qmd")
```

```{r}
#| label: qtbl-adaptive
#| dev: tikz
#| fig-process: pdf2png
options(tikzDefaultEngine = "xetex")

# footnotes
fn_scaled_score <- gt::md("Scaled Score: Mean = 10 [50th‰], SD ± 3 [16th‰, 84th‰]")
fn_standard_score <- gt::md("Index Score: Mean = 100 [50th‰], SD ± 15 [16th‰, 84th‰]")
fn_t_score <- gt::md("*T*-Score: Mean = 50 [50th‰], SD ± 10 [16th‰, 84th‰]")
fn_z_score <- gt::md("*z*-Score: Mean = 0 [50th‰], SD ± 1 [16th‰, 84th‰]")
z_score_label <- "*z*-Score: Mean = 0 [50th‰], SD ± 1 [16th‰, 84th‰]"

pheno <- "adaptive"
table_name <- "table_adaptive"

grp_adaptive <- list(
  standard_score = c("ABAS-3"),
  scaled_score = c("ABAS-3")
)
vertical_padding <- 0.05
multiline <- TRUE

bwu::tbl_gt(data,
  pheno = pheno,
  table_name = table_name,
  fn_scaled_score = fn_scaled_score,
  fn_standard_score = fn_standard_score,
  grp_scaled_score = grp_adaptive[["scaled_score"]],
  grp_standard_score = grp_adaptive[["standard_score"]],
  dynamic_grp = grp_adaptive,
  vertical_padding = vertical_padding,
  multiline = multiline
)
```

```{r}
#| label: fig-adaptive
#| fig-cap: "ADD CAPTION HERE"

# Arguments
adaptive <- dplyr::filter(data, !is.na(percentile))
data <- adaptive
x <- data$z_mean_narrow
y <- data$narrow
colors <- NULL
return_plot <- TRUE
# return_plot <- Sys.getenv("RETURN_PLOT")
filename <- "fig_adaptive.svg"

bwu::dotplot(
  data = data,
  x = x,
  y = y,
  colors = colors,
  return_plot = return_plot,
  filename = filename
)
```

```{=typst}
#let domain(title: none, file_qtbl, file_fig) = {
  let font = (font: "Fira Sans", size: 9pt)
  set text(..font)
    grid(
      columns: (50%, 50%),
      gutter: 8pt,
        figure([#image(file_qtbl)],
          caption: figure.caption(position: top, [#title]),
          kind: "qtbl",
          supplement: [*Table*],
          ),
        figure([#image(file_fig, width: auto)],
          caption: figure.caption(position: bottom, [
            Sensorimotor tasks refer to the capacity to control hand movements
            quickly, smoothly, and with adequate precision, which are required
            to engage in activities such as writing and drawing.
            ]),
          caption-pos: bottom,
          placement: none,
          kind: "image",
          supplement: [*Fig.*],
          gap: 0.5em,
        ),
      )
  }
```

```{=typst}
#let title = "Adaptive"
#let file_qtbl = "table_adaptive.png"
#let file_fig = "_02-11_adaptive_files/figure-typst/fig-adaptive-1.svg"
#domain(
  title: [#title Test Scores],
  file_qtbl,
  file_fig
  )
```

---
title: "Pluck Tables from NEPSY-2 PDF"
---

# NEPSY-2

NOTES: - First fix word doc for percentiles and font size

## Test

```{r test}
test <- "nepsy2"
```

## Patient initials

```{r patient}
patient <- "Biggie"
```

## Pages

Need to check each PDF to see what page(s) tables are located on.
Will be different for each individual.

```{r pages}
pages <- c(2, 3, 4, 5, 6)
```

## Load libraries

```{r setup, include=FALSE}
Sys.setenv(JAVA_HOME = "/Library/Java/JavaVirtualMachines/temurin-11.jdk/Contents/Home")
options(java.parameters = "-Xmx16000m")
library(knitr)
library(xfun)
knitr::opts_chunk$set(
  root.dir = normalizePath("./"),
  echo = FALSE,
  message = FALSE,
  warning = FALSE,
  error = TRUE
)
library(tabulapdf)
library(rJava)
library(shiny)
library(miniUI)
library(here)
library(pdftools)
library(tidyverse)
library(fs)
library(data.table)
library(magrittr)
library(kableExtra)
library(formattable)
library(DT)
library(ggiraph)
library(hablar)
library(tibble)
```

## Load functions

```{r functions}
source(file = here::here("R/gpluck_locate_areas.R"), local = knitr::knit_global())
source(file = here::here("R/gpluck_extract_table.R"), local = knitr::knit_global())
source(file = here::here("R/gpluck_make_columns.R"), local = knitr::knit_global())
source(file = here::here("R/gpluck_make_score_ranges.R"), local = knitr::knit_global())
```

# tabulapdf

## Upload/attach PDF

```{r choose}
nepsy2_pdf <- file.choose()
```

```{r save}
readr::write_lines(nepsy2_pdf, here::here(patient, "pre_csv", "nepsy2_pdf"))
```

```{r read}
nepsy2_pdf <- readr::read_lines(here::here(patient, "pre_csv", "nepsy2_pdf"))
```

## Locate areas

```{r locate-areas-pdf}
area <- gpluck_locate_areas(
  file = nepsy2_pdf,
  pages = pages
)
```

```{r save-areas}
readr::write_rds(area, here::here(patient, "pre_csv", "area_nepsy2.rds"))
```

```{r read-areas}
area <- readr::read_rds(here::here(patient, "pre_csv", "area_nepsy2.rds"))
```

## Extract tables

Change pages per patient.

```{r extract-table-pdf}
table <- gpluck_extract_table(
  file = nepsy2_pdf,
  pages = pages,
  area = area,
  guess = NULL,
  method = "stream",
  output = "matrix"
)
```

# Tidy Tables

## Column names per test/subtest/measure

This will vary by measure/table.

```{r colnames}
colnames1 <- c(
  "scale",
  "raw_score",
  "score",
  "percentile",
  "base_rate",
  "category"
)
colnames2 <- c(
  "scale",
  "raw_score",
  "score",
  "percentile",
  "category"
)
```

# Attention and Executive Functioning

Note: reduce font size in Word, then resave PDF (8-point font).

```{r tb1}
table1 <- as_tibble(table[[1]])
colnames(table1) <- colnames1
table1 <- dplyr::na_if(table1, "")
table1 <- dplyr::na_if(table1, "NA")
table1 <- dplyr::na_if(table1, "-")
table1 <- dplyr::na_if(table1, "--")
table1 <- dplyr::na_if(table1, "---")
table1 <- table1 %>%
  separate(percentile, c("A", "B"), extra = "merge", fill = "right") |>
  mutate_at(vars(A, B), as.numeric) |>
  mutate(percentile = ifelse(is.na(B), A, (A + B) / 2))
to_double <- c("raw_score", "score", "percentile")
table1 <- table1 |> hablar::convert(dbl(all_of(to_double)))
table1$percentile <- round(table1$percentile, 0L)
```

```{r slice1}
table1 <- table1 |> mutate(absort = paste0(seq_len(nrow(table1))))
table1$absort <- as.numeric(table1$absort)
table1 <- table1 |>
  # arrange(desc(score)) |>
  arrange(desc(percentile)) |>
  slice(1:12) |> # change this each time
  arrange(absort)
```

```{r names1}
names1 <- c(
  "Clocks",
  # "Animal Sorting Correct Sorts",
  # "Animal Sorting Errors",
  # "Animal Sorting Repeated Sort Errors",
  # "Animal Sorting Novel Sort Errors",
  # "Animal Sorting",
  # "Auditory Attention Correct",
  # "Auditory Attention",
  # "Auditory Attention Omission Errors",
  # "Auditory Attention Commission Errors",
  # "Auditory Attention Inhibitory Errors",
  # "Response Set Correct",
  # "Response Set",
  # "Response Set Omission Errors",
  # "Response Set Commission Errors",
  # "Response Set Inhibitory Errors",
  # "AA vs. RS",
  "Naming Time",
  "Naming",
  "Naming Errors",
  "Naming Self-Corrected Errors",
  "Naming Uncorrected Errors",
  "Inhibition Time",
  "Inhibition",
  "Inhibition Errors",
  "Inhibition Self-Corrected Errors",
  "Inhibition Uncorrected Errors",
  # "Switching Time",
  # "Switching",
  # "Switching Errors",
  # "Switching Self-Corrected Errors",
  # "Switching Uncorrected Errors",
  "Naming vs. Inhibition"
  # "Inhibition vs. Switching",
  # "Inhibition Total Errors"
)
rownames(table1) <- names1
table1 <- 
  table1 %>% 
  dplyr::rename(scale2 = scale) %>% 
  tibble::rownames_to_column(., var = "scale") 
# table1[1, 1] <- c("Animal Sorting Correct Sorts")
# table1[2, 1] <- c("Animal Sorting")
# table1[3, 1] <- c("Clocks")
# table1[1, 1] <- c("Naming Time")
# table1[2, 1] <- c("Naming")
# table1[3, 1] <- c("Inhibition Time")
# table1[4, 1] <- c("Inhibition")
# table1[8, 1] <- c("Switching Time")
# table1[9, 1] <- c("Switching")
# table1[10, 1] <- c("Inhibition Total Errors")
```

# Language

These will vary by individual.

```{r to-tibble2}
table2 <- as_tibble(table[[2]])
colnames(table2) <- colnames2
table2 <- dplyr::na_if(table2, "")
table2 <- dplyr::na_if(table2, "NA")
table2 <- dplyr::na_if(table2, "-")
table2 <- dplyr::na_if(table2, "--")
table2 <- dplyr::na_if(table2, "---")
table2 <- table2 %>%
  separate(percentile, c("A", "B"), extra = "merge", fill = "right") |>
  mutate_at(vars(A, B), as.numeric) |>
  mutate(percentile = ifelse(is.na(B), A, (A + B) / 2)) # changed a/b
to_double <- c("raw_score", "score", "percentile")
table2 <- table2 |> hablar::convert(dbl(all_of(to_double)))
table2$percentile <- round(table2$percentile, 0L)
```

```{r slice2}
table2 <- table2 %>% mutate(absort = paste0(seq_len(nrow(table2))))
table2$absort <- as.numeric(table2$absort)
table2 <- table2 |>
  # arrange(desc(score)) |>
  arrange(desc(percentile)) |>
  slice(1:5) |>
  arrange(absort) #%>%
  #slice(-3, -5)
```

```{r names2}
names2 <- c(
  # "Word Generation-Semantic",
  # "Word Generation-Initial Letter",
  # "Semantic vs. Initial Letter"
  "Comprehension of Instructions",
  "Speeded Naming Time",
  "Speeded Naming Correct",
  "Speeded Naming",
  "Speeded Naming Self-Corrected Errors"
)
rownames(table2) <- names2
table2 <- 
  table2 %>% 
  dplyr::rename(scale2 = scale) %>% 
  tibble::rownames_to_column(., var = "scale")
# table2[1, 1] <- c("Comprehension of Instructions")
# table2[2, 1] <- c("Speeded Naming Time")
# table2[3, 1] <- c("Speeded Naming")
# table2[4, 1] <- c("Word Generation-Semantic")
# table2[5, 1] <- c("Word Generation-Initial Letter")
```

# Memory and Learning

```{r to-tibble3}
table3 <- as_tibble(table[[3]])
colnames(table3) <- colnames1
table3 <- dplyr::na_if(table3, "")
table3 <- dplyr::na_if(table3, "NA")
table3 <- dplyr::na_if(table3, "-")
table3 <- dplyr::na_if(table3, "--")
table3 <- dplyr::na_if(table3, "---")
table3 <- table3 %>%
  separate(percentile, c("A", "B"), extra = "merge", fill = "right") |>
  mutate_at(vars(A, B), as.numeric) |>
  mutate(percentile = ifelse(is.na(B), A, (A + B) / 2))
to_double <- c("raw_score", "score", "percentile")
table3 <- table3 |> hablar::convert(dbl(all_of(to_double)))
table3$percentile <- round(table3$percentile, 0L)
```

```{r}
table3 <- table3 |> mutate(absort = paste0(seq_len(nrow(table3))))
table3$absort <- as.numeric(table3$absort)
table3 <- table3 |>
  # arrange(desc(score)) |>
  arrange(desc(percentile)) |>
  slice(1:7) |> # count number of rows from PDF
  arrange(absort)
```

```{r rownames3}
names3 <- c(
  "Memory for Faces",
  "Memory for Faces Delayed",
  "MF vs. MFD",
  "Narrative Memory Free Recall",
  "Word List Interference-Repetition",
  "Word List Interference-Recall",
  "Repetition vs. Recall"
  # "List Memory and List Memory Delayed",
  # "Narrative Memory Free and Cued Recall",
  # "Narrative Memory Free Recall"
  # "Memory for Designs",
  # "Memory for Designs Content",
  # "Memory for Designs Spatial",
  # "MD Content vs. Spatial",
  # "Memory for Designs Delayed",
  # "Memory for Designs Delayed Content",
  # "Memory for Designs Delayed Spatial",
  # "MDD Content vs. Spatial",
  # "MD vs. MDD",
  # "Narrative Memory Free and Cued Recall",
  # "Narrative Memory Free Recall",
  # "Narrative Memory Recognition",
  # "Free and Cued Recall vs. Recognition"
)
rownames(table3) <- names3
table3 <- 
  table3 %>% 
  dplyr::rename(scale2 = scale) %>% 
  tibble::rownames_to_column(., var = "scale") #%>% 
  #dplyr::slice(-3, -7)
# table3[1, 1] <- c("Memory for Faces")
# table3[2, 1] <- c("Memory for Faces Delayed")
# table3[3, 1] <- c("Narrative Memory Free Recall")
# table3[4, 1] <- c("Word List Interference-Repetition")
# table3[5, 1] <- c("Word List Interference-Recall")
# table3[1, 1] <- c("List Memory and List Memory Delayed")
# table3[2, 1] <- c("Narrative Memory Free and Cued Recall")
# table3[3, 1] <- c("Narrative Memory Free Recall")
```

# Sensorimotor

```{r to-tibble4}
table4 <- as_tibble(table[[4]])
colnames(table4) <- colnames1
table4 <- dplyr::na_if(table4, "")
table4 <- dplyr::na_if(table4, "NA")
table4 <- dplyr::na_if(table4, "-")
table4 <- dplyr::na_if(table4, "--")
table4 <- dplyr::na_if(table4, "---")
table4 <- table4 %>%
  separate(percentile, c("A", "B"), extra = "merge", fill = "right") |>
  mutate_at(vars(A, B), as.numeric) |>
  mutate(percentile = ifelse(is.na(B), A, (A + B) / 2))
to_double <- c("raw_score", "score", "percentile")
table4 <- table4 |> hablar::convert(dbl(all_of(to_double)))
table4$percentile <- round(table4$percentile, 0L)
```

```{r fix4}
table4 <- table4 |> mutate(absort = paste0(seq_len(nrow(table4))))
table4$absort <- as.numeric(table4$absort)
table4 <- table4 |>
  # arrange(desc(score)) |>
  arrange(desc(percentile)) |>
  slice(1:4) |>
  arrange(absort) #%>%
  # slice(-5, -6)
```

```{r rownames4}
names4 <- c(
  "Visuomotor Precision Time",
  "Visuomotor Precision Errors",
  "Visuomotor Precision",
  "Visuomotor Precision Pencil Lifts"
  # "Fingertip Tapping Dominant Hand Repetitions",
  # "Fingertip Tapping Dominant Hand Sequences",
  # "Fingertip Tapping Nondominant Hand Repetitions",
  # "Fingertip Tapping Nondominant Hand Sequences",
  # "Fingertip Tapping Dominant Hand",
  # "Fingertip Tapping Nondominant Hand",
  # "Fingertip Tapping Repetitions",
  # "Fingertip Tapping Sequences",
  # "Dominant vs. Nondominant",
  # "Repetitions vs. Sequences"
  # "Visuomotor Precision Time"
)
rownames(table4) <- names4
table4 <- 
  table4 %>% 
  dplyr::rename(scale2 = scale) %>% 
  tibble::rownames_to_column(., var = "scale")
# table4[1, 1] <- c("Fingertip Tapping Dominant Hand")
# table4[2, 1] <- c("Fingertip Tapping Nondominant Hand")
# table4[3, 1] <- c("Fingertip Tapping Repetitions")
# table4[4, 1] <- c("Fingertip Tapping Sequences")
# table4[5, 1] <- c("Imitating Hand Positions")
# table4[1, 1] <- c("Visuomotor Precision Time")
# table4[7, 1] <- c("Visuomotor Precision")
```

# Social Cognition

TODO

```{r}
# table5 <- as_tibble(table[[5]])
# colnames(table5) <- colnames2
# table5 <- dplyr::na_if(table5, "")
# table5 <- dplyr::na_if(table5, "NA")
# table5 <- dplyr::na_if(table5, "-")
# table5 <- dplyr::na_if(table5, "--")
# table5 <- dplyr::na_if(table5, "---")
# to_double <- c("raw_score", "score", "percentile")
# table5 <- table5 |> hablar::convert(dbl(all_of(to_double)))
# table1$percentile <- round(table1$percentile, 0L)
```

```{r}
# table5 <- table5 |> mutate(absort = paste0(seq_len(nrow(table5))))
# table5$absort <- as.numeric(table5$absort)
# table5 <- table5 |>
#   arrange(desc(score)) |>
#   arrange(desc(percentile)) |>
#   slice(1) |>
#   arrange(absort)
```

```{r}
# table5[1, 1] <- c("Design Copying Process")
```

# Visuospatial Processing

```{r tb6}
table6 <- as_tibble(table[[5]]) # note 5, not 6
colnames(table6) <- colnames2
table6 <- dplyr::na_if(table6, "")
table6 <- dplyr::na_if(table6, "NA")
table6 <- dplyr::na_if(table6, "-")
table6 <- dplyr::na_if(table6, "--")
table6 <- dplyr::na_if(table6, "---")
table6 <- table6 %>%
  separate(percentile, c("A", "B"), extra = "merge", fill = "right") |>
  mutate_at(vars(A, B), as.numeric) |>
  mutate(percentile = ifelse(is.na(B), A, (A + B) / 2))
to_double <- c("raw_score", "score", "percentile")
table6 <- table6 |> hablar::convert(dbl(all_of(to_double)))
table6$percentile <- round(table6$percentile, 0L)
```

```{r fix6}
table6 <- table6 |> mutate(absort = paste0(seq_len(nrow(table6))))
table6$absort <- as.numeric(table6$absort)
table6 <- table6 |>
  # arrange(desc(score)) |>
  arrange(desc(percentile)) |>
  slice(1:7) |> # change
  arrange(absort)
```

```{r rownames6}
names6 <- c(
"Design Copying Process",
"Design Copying Process Motor",
"Design Copying Process Global",
"Design Copying Process Local",
"Global vs. Local",
"Design Copying General",
"Geometric Puzzles"
  # "Arrows",
  # "Design Copying General"
  # "Geometric Puzzles"
)
rownames(table6) <- names6
table6 <- 
  table6 %>% 
  dplyr::rename(scale2 = scale) %>% 
  tibble::rownames_to_column(., var = "scale")
# table6[1, 1] <- c("Geometric Puzzles")
# table6[1, 1] <- c("Design Copying Process")
```

## Select variables to keep

This will vary by measure.

```{r keep}
keep <- c("scale", "raw_score", "score", "percentile")
table1 <- table1 |> dplyr::select(all_of(keep))
table2 <- table2 |> dplyr::select(all_of(keep))
table3 <- table3 |> dplyr::select(all_of(keep))
table4 <- table4 |> dplyr::select(all_of(keep))
# table5 <- table5 |> dplyr::select(all_of(keep))
table6 <- table6 |> dplyr::select(all_of(keep))
```

# Classifications

## Make columns

```{r mutate1}
table1 <- gpluck_make_columns(
  table1,
  range = "",
  ci_95 = "",
  test = "nepsy2",
  test_name = "NEPSY-2",
  domain = "Attention/Executive",
  subdomain = "",
  narrow = "",
  pass = "",
  verbal = "",
  timed = "",
  test_type = "npsych_test",
  score_type = "scaled_score",
  description = ""
)
```

```{r mutate2}
table2 <- gpluck_make_columns(
  table2,
  range = "",
  ci_95 = "",
  test = "nepsy2",
  test_name = "NEPSY-2",
  domain = "Verbal/Language",
  subdomain = "",
  narrow = "",
  pass = "",
  verbal = "Verbal",
  timed = "",
  test_type = "npsych_test",
  score_type = "scaled_score",
  description = ""
)
```

```{r mutate3}
table3 <- gpluck_make_columns(
  table3,
  range = "",
  ci_95 = "",
  test = "nepsy2",
  test_name = "NEPSY-2",
  domain = "Memory",
  subdomain = "",
  narrow = "",
  pass = "",
  verbal = "",
  timed = "",
  test_type = "npsych_test",
  score_type = "scaled_score",
  description = ""
)
```

```{r mutate4}
table4 <- gpluck_make_columns(
  table4,
  range = "",
  ci_95 = "",
  test = "nepsy2",
  test_name = "NEPSY-2",
  domain = "Motor",
  subdomain = "",
  narrow = "",
  pass = "",
  verbal = "Nonverbal",
  timed = "",
  test_type = "npsych_test",
  score_type = "scaled_score",
  description = ""
)
```

```{r mutate5}
# table5 <- gpluck_make_columns(
#   table5,
#   range = "",
#   ci_95 = "",
#   test = "nepsy2",
#   test_name = "NEPSY-2",
#   domain = "Social Cognition",
#   subdomain = "",
#   narrow = "",
#   timed = "FALSE",
#   verbal = "Verbal",
#   pass = "",
#   test_type = "npsych_test",
#   score_type = "scaled_score",
#   description = ""
# )
```

```{r mutate6}
table6 <- gpluck_make_columns(
  table6,
  range = "",
  ci_95 = "",
  test = "nepsy2",
  test_name = "NEPSY-2",
  domain = "Visual Perception/Construction",
  subdomain = "",
  narrow = "",
  pass = "",
  verbal = "Nonverbal",
  timed = "Untimed",
  test_type = "npsych_test",
  score_type = "scaled_score",
  description = ""
)
```

## Test score ranges

```{r range}
table1 <- gpluck_make_score_ranges(table = table1, test_type = "npsych_test")
table2 <- gpluck_make_score_ranges(table = table2, test_type = "npsych_test")
table3 <- gpluck_make_score_ranges(table = table3, test_type = "npsych_test")
table4 <- gpluck_make_score_ranges(table = table4, test_type = "npsych_test")
# table5 <- gpluck_make_score_ranges(table = table5, test_type = "npsych_test")
table6 <- gpluck_make_score_ranges(table = table6, test_type = "npsych_test")
```

```{r}
table_list <- table
table <- rbind(table1, table2, table3, table4, table6)
```

## Domains

This is unnceccsary i think

```{r}
table <-
  table |>
  mutate(
    domain = case_when(
      # EF
      scale == "Clocks" ~ "Attention/Executive",
      scale == "Animal Sorting Correct Sorts" ~ "Attention/Executive",
      scale == "Animal Sorting Errors" ~ "Attention/Executive",
      scale == "Animal Sorting Repeated Sort Errors" ~ "Attention/Executive",
      scale == "Animal Sorting Novel Sort Errors" ~ "Attention/Executive",
      scale == "Animal Sorting" ~ "Attention/Executive",
      scale == "Naming Time" ~ "Verbal/Language",
      scale == "Naming" ~ "Verbal/Language",
      scale == "Naming Errors" ~ "Verbal/Language",
      scale == "Naming Self-Corrected Errors" ~ "Attention/Executive",
      scale == "Naming Uncorrected Errors" ~ "Verbal/Language",
      scale == "Inhibition Time" ~ "Attention/Executive",
      scale == "Inhibition" ~ "Attention/Executive",
      scale == "Inhibition Errors" ~ "Attention/Executive",
      scale == "Inhibition Self-Corrected Errors" ~ "Attention/Executive",
      scale == "Inhibition Uncorrected Errors" ~ "Attention/Executive",
      scale == "Switching Time" ~ "Attention/Executive",
      scale == "Switching" ~ "Attention/Executive",
      scale == "Switching Errors" ~ "Attention/Executive",
      scale == "Switching Self-Corrected Errors" ~ "Attention/Executive",
      scale == "Switching Uncorrected Errors" ~ "Attention/Executive",
      scale == "Naming vs. Inhibition" ~ "Attention/Executive",
      scale == "Inhibition vs. Switching" ~ "Attention/Executive",
      scale == "Inhibition Total Errors" ~ "Attention/Executive",
      # LANG
      scale == "Comprehension of Instructions" ~ "Verbal/Language",
      scale == "Speeded Naming Time" ~ "Verbal/Language",
      scale == "Speeded Naming Correct" ~ "Verbal/Language",
      scale == "Speeded Naming" ~ "Verbal/Language",
      scale == "Speeded Naming Self-Corrected Errors" ~ "Attention/Executive",
      scale == "Word Generation-Semantic" ~ "Verbal/Language",
      scale == "Word Generation-Initial Letter" ~ "Verbal/Language",
      scale == "Semantic vs. Initial Letter" ~ "Verbal/Language",
      # MEM
      scale == "Memory for Faces" ~ "Memory",
      scale == "Memory for Faces Delayed" ~ "Memory",
      scale == "Word List Interference Repetition" ~ "Memory",
      scale == "Word List Interference Recall" ~ "Memory",
      scale == "List Memory and List Memory Delayed" ~ "Memory",
      scale == "Narrative Memory Free and Cued Recall" ~ "Memory",
      scale == "Narrative Memory Free Recall" ~ "Memory",
      scale == "Narrative Memory Recognition" ~ "Memory",
      scale == "Recall vs Recognition" ~ "Memory",
      scale == "Memory for Designs" ~ "Memory",
      scale == "Memory for Designs Content" ~ "Memory",
      scale == "Memory for Designs Spatial" ~ "Memory",
      scale == "Memory for Designs Delayed" ~ "Memory",
      scale == "Memory for Designs Delayed Content" ~ "Memory",
      scale == "Memory for Designs Delayed Spatial" ~ "Memory",
      # MOTOR
      scale == "Fingertip Tapping Dominant Hand Repetitions" ~ "Motor",
      scale == "Fingertip Tapping Dominant Hand Sequences" ~ "Motor",
      scale == "Fingertip Tapping Nondominant Hand Repetitions" ~ "Motor",
      scale == "Fingertip Tapping Nondominant Hand Sequences" ~ "Motor",
      scale == "Fingertip Tapping Dominant Hand" ~ "Motor",
      scale == "Fingertip Tapping Nondominant Hand" ~ "Motor",
      scale == "Fingertip Tapping Repetitions" ~ "Motor",
      scale == "Fingertip Tapping Sequences" ~ "Motor",
      scale == "Dominant vs. Nondominant" ~ "Motor",
      scale == "Repetitions vs. Sequences" ~ "Motor",
      scale == "Visuomotor Precision Time" ~ "Motor",
      scale == "Visuomotor Precision Errors" ~ "Motor",
      scale == "Visuomotor Precision" ~ "Motor",
      scale == "Visuomotor Precision Pencil Lifts" ~ "Motor",
      scale == "Imitating Hand Positions" ~ "Motor",
      # SOCIAL
      scale == "Affect Recognition" ~ "Social Cognition",
      scale == "Affect Recognition Happy Errors" ~ "Social Cognition",
      scale == "Affect Recognition Sad Errors" ~ "Social Cognition",
      scale == "Affect Recognition Neutral Errors" ~ "Social Cognition",
      scale == "Affect Recognition Fear Errors" ~ "Social Cognition",
      scale == "Affect Recognition Angry Errors" ~ "Social Cognition",
      scale == "Affect Recognition Disgust Errors" ~ "Social Cognition",
      scale == "Theory of Mind" ~ "Social Cognition",
      scale == "Theory of Mind Verbal" ~ "Social Cognition",
      # SPATIAL
      scale == "Arrows" ~ "Visual Perception/Construction",
      scale == "Design Copying General" ~ "Visual Perception/Construction",
      scale == "Design Copying Process" ~ "Visual Perception/Construction",
      scale == "Design Copying Process Global" ~ "Visual Perception/Construction",
      scale == "Design Copying Process Local" ~ "Visual Perception/Construction",
      scale == "Design Copying Process Motor" ~ "Visual Perception/Construction",
      scale == "Geometric Puzzles" ~ "Visual Perception/Construction",
      TRUE ~ as.character(domain)
    )
  )
```

## Subdomains

As necessary.

```{r subdomain1}
table <-
  table |>
  mutate(
    subdomain = case_when(
      # EF
      scale == "Auditory Attention Correct" ~ "Attention",
      scale == "Auditory Attention" ~ "Attention",
      scale == "Auditory Attention Omission Errors" ~ "Response Monitoring",
      scale == "Auditory Attention Commission Errors" ~ "Response Monitoring",
      scale == "Auditory Attention Inhibitory Errors" ~ "Response Monitoring",
      scale == "Response Set Correct" ~ "Attention",
      scale == "Response Set" ~ "Attention",
      scale == "Response Set Omission Errors" ~ "Response Monitoring",
      scale == "Response Set Commission Errors" ~ "Response Monitoring",
      scale == "Response Set Inhibitory Errors" ~ "Response Monitoring",
      scale == "AA vs. RS" ~ "",
      scale == "Clocks" ~ "Planning",
      scale == "Animal Sorting Correct Sorts" ~ "Concept Formation",
      scale == "Animal Sorting Errors" ~ "Response Monitoring",
      scale == "Animal Sorting Repeated Sort Errors" ~ "Response Monitoring",
      scale == "Animal Sorting Novel Sort Errors" ~ "Response Monitoring",
      scale == "Animal Sorting" ~ "Concept Formation",
      scale == "Naming Time" ~ "Naming Facility",
      scale == "Naming" ~ "Naming Facility",
      scale == "Naming Errors" ~ "Response Monitoring",
      scale == "Naming Self-Corrected Errors" ~ "Response Monitoring",
      scale == "Naming Uncorrected Errors" ~ "Response Monitoring",
      scale == "Inhibition Time" ~ "Cognitive Control",
      scale == "Inhibition" ~ "Cognitive Control",
      scale == "Inhibition Errors" ~ "Response Monitoring",
      scale == "Inhibition Self-Corrected Errors" ~ "Response Monitoring",
      scale == "Inhibition Uncorrected Errors" ~ "Response Monitoring",
      scale == "Switching Time" ~ "Cognitive Flexibility",
      scale == "Switching" ~ "Cognitive Flexibility",
      scale == "Switching Errors" ~ "Response Monitoring",
      scale == "Switching Self-Corrected Errors" ~ "Response Monitoring",
      scale == "Switching Uncorrected Errors" ~ "Response Monitoring",
      scale == "Naming vs. Inhibition" ~ "",
      scale == "Inhibition vs. Switching" ~ "",
      scale == "Inhibition Total Errors" ~ "Response Monitoring",
      # Lang
      scale == "Comprehension of Instructions" ~ "Receptive Language",
      scale == "Speeded Naming Time" ~ "Naming Facility",
      scale == "Speeded Naming Correct" ~ "Naming Facility",
      scale == "Speeded Naming" ~ "Naming Facility",
      scale == "Speeded Naming Self-Corrected Errors" ~ "Response Monitoring",
      scale == "Word Generation-Semantic" ~ "Verbal Fluency",
      scale == "Word Generation-Initial Letter" ~ "Verbal Fluency",
      scale == "Semantic vs. Initial Letter" ~ "",
      # MEM
      scale == "Memory for Faces" ~ "Nonverbal Memory",
      scale == "Memory for Faces Delayed" ~ "Nonverbal Memory",
      scale == "Word List Interference-Repetition" ~ "Verbal Memory",
      scale == "Word List Interference-Recall" ~ "Verbal Memory",
      scale == "List Memory and List Memory Delayed" ~ "Verbal Memory",
      scale == "Narrative Memory Free and Cued Recall" ~ "Verbal Memory",
      scale == "Narrative Memory Free Recall" ~ "Verbal Memory",
      scale == "Narrative Memory Recognition" ~ "Verbal Memory",
      scale == "Recall vs Recognition" ~ "",
      scale == "Memory for Designs" ~ "Nonverbal Memory",
      scale == "Memory for Designs Content" ~ "Nonverbal Memory",
      scale == "Memory for Designs Spatial" ~ "Nonverbal Memory",
      scale == "Memory for Designs Delayed" ~ "Nonverbal Memory",
      scale == "Memory for Designs Delayed Content" ~ "Nonverbal Memory",
      scale == "Memory for Designs Delayed Spatial" ~ "Nonverbal Memory",
      # MOTOR
      scale == "Fingertip Tapping Dominant Hand Repetitions" ~ "Fine Motor Dexterity",
      scale == "Fingertip Tapping Dominant Hand Sequences" ~ "Fine Motor Dexterity",
      scale == "Fingertip Tapping Nondominant Hand Repetitions" ~ "Fine Motor Dexterity",
      scale == "Fingertip Tapping Nondominant Hand Sequences" ~ "Fine Motor Dexterity",
      scale == "Fingertip Tapping Dominant Hand" ~ "Fine Motor Dexterity",
      scale == "Fingertip Tapping Nondominant Hand" ~ "Fine Motor Dexterity",
      scale == "Fingertip Tapping Repetitions" ~ "Fine Motor Dexterity",
      scale == "Fingertip Tapping Sequences" ~ "Fine Motor Dexterity",
      scale == "Dominant vs. Nondominant" ~ "Dominant vs. Nondominant",
      scale == "Repetitions vs. Sequences" ~ "",
      scale == "Visuomotor Precision Time" ~ "Graphomotor Speed",
      scale == "Visuomotor Precision Errors" ~ "Response Monitoring",
      scale == "Visuomotor Precision" ~ "Graphomotor Speed",
      scale == "Visuomotor Precision Pencil Lifts" ~ "Graphomotor Speed",
      scale == "Imitating Hand Positions" ~ "Motor Imitation",
      # Soc Cog
      scale == "Affect Recognition" ~ "Affect Recognition",
      scale == "Affect Recognition Happy Errors" ~ "Affect Recognition",
      scale == "Affect Recognition Sad Errors" ~ "Affect Recognition",
      scale == "Affect Recognition Neutral Errors" ~ "Affect Recognition",
      scale == "Affect Recognition Fear Errors" ~ "Affect Recognition",
      scale == "Affect Recognition Angry Errors" ~ "Affect Recognition",
      scale == "Affect Recognition Disgust Errors" ~ "Affect Recognition",
      scale == "Theory of Mind" ~ "Theory of Mind",
      scale == "Theory of Mind Verbal" ~ "Theory of Mind",
      # Spatial
      scale == "Arrows" ~ "Visuoperception",
      scale == "Design Copying General" ~ "Visual Processing",
      scale == "Design Copying Process" ~ "Visual Processing",
      scale == "Design Copying Process Global" ~ "Visual Processing",
      scale == "Design Copying Process Local" ~ "Visual Processing",
      scale == "Design Copying Process Motor" ~ "Visual Processing",
      scale == "Global vs. Local" ~ "",
      scale == "Geometric Puzzles" ~ "Fluid Reasoning",
      TRUE ~ as.character(subdomain)
    )
  )
```

## Narrow subdomains

As necessary.

```{r narrow}
table <-
  table |>
  mutate(
    narrow = case_when(
      scale == "Auditory Attention Correct" ~ "Cognitive Efficiency",
      scale == "Auditory Attention" ~ "Cognitive Efficiency",
      scale == "Auditory Attention Omission Errors" ~ "Response Monitoring",
      scale == "Auditory Attention Commission Errors" ~ "Response Monitoring",
      scale == "Auditory Attention Inhibitory Errors" ~ "Response Monitoring",
      scale == "Response Set Correct" ~ "Cognitive Efficiency",
      scale == "Response Set" ~ "Cognitive Efficiency",
      scale == "Response Set Omission Errors" ~ "Response Monitoring",
      scale == "Response Set Commission Errors" ~ "Response Monitoring",
      scale == "Response Set Inhibitory Errors" ~ "Response Monitoring",
      scale == "AA vs. RS" ~ "",
      scale == "Clocks" ~ "Planning",
      scale == "Animal Sorting Correct Sorts" ~ "Concept Formation",
      scale == "Animal Sorting Errors" ~ "Concept Formation",
      scale == "Animal Sorting Repeated Sort Errors" ~ "Concept Formation",
      scale == "Animal Sorting Novel Sort Errors" ~ "Concept Formation",
      scale == "Animal Sorting" ~ "Concept Formation",
      scale == "Naming Time" ~ "Naming Facility",
      scale == "Naming" ~ "Naming Facility",
      scale == "Naming Errors" ~ "Response Monitoring",
      scale == "Naming Self-Corrected Errors" ~ "Response Monitoring",
      scale == "Naming Uncorrected Errors" ~ "Rapid Naming",
      scale == "Inhibition Time" ~ "Cognitive Control",
      scale == "Inhibition" ~ "Cognitive Control",
      scale == "Inhibition Errors" ~ "Response Monitoring",
      scale == "Inhibition Self-Corrected Errors" ~ "Response Monitoring",
      scale == "Inhibition Uncorrected Errors" ~ "Response Monitoring",
      scale == "Switching Time" ~ "Cognitive Flexibility",
      scale == "Switching" ~ "Cognitive Flexibility",
      scale == "Switching Errors" ~ "Response Monitoring",
      scale == "Switching Self-Corrected Errors" ~ "Response Monitoring",
      scale == "Switching Uncorrected Errors" ~ "Response Monitoring",
      scale == "Naming vs. Inhibition" ~ "",
      scale == "Inhibition vs. Switching" ~ "",
      scale == "Inhibition Total Errors" ~ "Response Monitoring",
      # Lang
      scale == "Comprehension of Instructions" ~ "Listening Ability",
      scale == "Speeded Naming Time" ~ "Naming Facility",
      scale == "Speeded Naming Correct" ~ "Naming Facility",
      scale == "Speeded Naming" ~ "Naming Facility",
      scale == "Speeded Naming Self-Corrected Errors" ~ "Response Monitoring",
      scale == "Word Generation-Semantic" ~ "Semantic Fluency",
      scale == "Word Generation-Initial Letter" ~ "Phonemic Fluency",
      scale == "Semantic vs. Initial Letter" ~ "",
      # MEM
      scale == "Memory for Faces" ~ "Nonverbal Immediate Recall",
      scale == "Memory for Faces Delayed" ~ "Nonverbal Delayed Recall",
      scale == "Word List Interference-Repetition" ~ "Verbal Associative Learning",
      scale == "Word List Interference-Recall" ~ "Verbal Associative Recall",
      scale == "List Memory and List Memory Delayed" ~ "Verbal Immediate Recall",
      scale == "Narrative Memory Free and Cued Recall" ~ "Verbal Immediate Recall",
      scale == "Narrative Memory Free Recall" ~ "Verbal Immediate Recall",
      scale == "Narrative Memory Recognition" ~ "Verbal Recognitioin",
      scale == "Recall vs Recognition" ~ "",
      scale == "Memory for Designs" ~ "Nonverbal Immediate Recall",
      scale == "Memory for Designs Content" ~ "Nonverbal Immediate Recall",
      scale == "Memory for Designs Spatial" ~ "Nonverbal Immediate Recall",
      scale == "Memory for Designs Delayed" ~ "Nonverbal Delayed Recall",
      scale == "Memory for Designs Delayed Content" ~ "Nonverbal Delayed Recall",
      scale == "Memory for Designs Delayed Spatial" ~ "Nonverbal Delayed Recall",
      # Motor
      scale == "Fingertip Tapping Dominant Hand Repetitions" ~ "Finger Dexterity Dominant Hand",
      scale == "Fingertip Tapping Dominant Hand Sequences" ~ "Finger Dexterity Dominant Hand",
      scale == "Fingertip Tapping Nondominant Hand Repetitions" ~ "Finger Dexterity Nondominant Hand",
      scale == "Fingertip Tapping Nondominant Hand Sequences" ~ "Finger Dexterity Nondominant Hand",
      scale == "Fingertip Tapping Dominant Hand" ~ "Fine Motor Dexterity Dominant Hand",
      scale == "Fingertip Tapping Nondominant Hand" ~ "Fine Motor Dexterity Nondominant Hand",
      scale == "Fingertip Tapping Repetitions" ~ "Bilateral Finger Dexterity Repetitions",
      scale == "Fingertip Tapping Sequences" ~ "Bilateral Finger Dexterity Sequencing",
      scale == "Dominant vs. Nondominant" ~ "Dominant vs. Nondominant",
      scale == "Repetitions vs. Sequences" ~ "",
      scale == "Visuomotor Precision Time" ~ "Graphomotor Speed",
      scale == "Visuomotor Precision Errors" ~ "Graphomotor Speed",
      scale == "Visuomotor Precision" ~ "Graphomotor Speed",
      scale == "Visuomotor Precision Pencil Lifts" ~ "Graphomotor Speed",
      scale == "Imitating Hand Positions" ~ "Bilateral Motor Imitation",
      # Soc cog
      scale == "Affect Recognition" ~ "Affect Recognition",
      scale == "Affect Recognition Happy Errors" ~ "Affect Recognition",
      scale == "Affect Recognition Sad Errors" ~ "Affect Recognition",
      scale == "Affect Recognition Neutral Errors" ~ "Affect Recognition",
      scale == "Affect Recognition Fear Errors" ~ "Affect Recognition",
      scale == "Affect Recognition Angry Errors" ~ "Affect Recognition",
      scale == "Affect Recognition Disgust Errors" ~ "Affect Recognition",
      scale == "Theory of Mind" ~ "Theory of Mind",
      scale == "Theory of Mind Verbal" ~ "Theory of Mind",
      # Spatial
      scale == "Arrows" ~ "Visuoperception",
      scale == "Design Copying Process Global" ~ "Visuomotor Integration",
      scale == "Design Copying Process Local" ~ "Visuomotor Integration",
      scale == "Design Copying Process Motor" ~ "Visuomotor Integration",
      scale == "Design Copying General" ~ "Visuomotor Integration",
      scale == "Design Copying Process" ~ "Visuomotor Integration",
      scale == "Geometric Puzzles" ~ "Visualization",
      TRUE ~ as.character(narrow)
    )
  )
```

## PASS model

As necessary.

```{r pass}
table <-
  table |>
  mutate(
    pass = case_when(
      scale == "Auditory Attention Correct" ~ "Attention",
      scale == "Auditory Attention" ~ "Attention",
      scale == "Auditory Attention Omission Errors" ~ "Attention",
      scale == "Auditory Attention Commission Errors" ~ "Attention",
      scale == "Auditory Attention Inhibitory Errors" ~ "Attention",
      scale == "Response Set Correct" ~ "Attention",
      scale == "Response Set" ~ "Attention",
      scale == "Response Set Omission Errors" ~ "Attention",
      scale == "Response Set Commission Errors" ~ "Attention",
      scale == "Response Set Inhibitory Errors" ~ "Attention",
      scale == "AA vs. RS" ~ "",
      scale == "Clocks" ~ "Planning",
      scale == "Animal Sorting Correct Sorts" ~ "Successive",
      scale == "Animal Sorting Errors" ~ "Successive",
      scale == "Animal Sorting Repeated Sort Errors" ~ "Successive",
      scale == "Animal Sorting Novel Sort Errors" ~ "Successive",
      scale == "Animal Sorting" ~ "Successive",
      scale == "Naming Time" ~ "Attention",
      scale == "Naming" ~ "Attention",
      scale == "Naming Errors" ~ "Attention",
      scale == "Naming Self-Corrected Errors" ~ "Attention",
      scale == "Naming Uncorrected Errors" ~ "Attention",
      scale == "Inhibition Time" ~ "Attention",
      scale == "Inhibition" ~ "Attention",
      scale == "Inhibition Errors" ~ "Attention",
      scale == "Inhibition Self-Corrected Errors" ~ "Attention",
      scale == "Inhibition Uncorrected Errors" ~ "Attention",
      scale == "Switching Time" ~ "Attention",
      scale == "Switching" ~ "Attention",
      scale == "Switching Errors" ~ "Attention",
      scale == "Switching Self-Corrected Errors" ~ "Attention",
      scale == "Switching Uncorrected Errors" ~ "Attention",
      scale == "Naming vs. Inhibition" ~ "",
      scale == "Inhibition vs. Switching" ~ "",
      scale == "Inhibition Total Errors" ~ "Attention",
      scale == "Comprehension of Instructions" ~ "Successive",
      scale == "Speeded Naming Time" ~ "Attention",
      scale == "Speeded Naming Correct" ~ "Attention",
      scale == "Speeded Naming" ~ "Attention",
      scale == "Speeded Naming Self-Corrected Errors" ~ "Attention",
      scale == "Word Generation-Semantic" ~ "Successive",
      scale == "Word Generation-Initial Letter" ~ "Successive",
      scale == "Semantic vs. Initial Letter" ~ "",
      scale == "List Memory and List Memory Delayed" ~ "Verbal",
      scale == "Narrative Memory Free and Cued Recall" ~ "Successive",
      scale == "Narrative Memory Free Recall" ~ "Successive",
      scale == "Narrative Memory Recognition" ~ "Successive",
      scale == "Memory for Designs" ~ "Simultaneous",
      scale == "Memory for Designs Content" ~ "Simultaneous",
      scale == "Memory for Designs Spatial" ~ "Simultaneous",
      scale == "Memory for Designs Delayed" ~ "Simultaneous",
      scale == "Memory for Designs Delayed Content" ~ "Simultaneous",
      scale == "Memory for Designs Delayed Spatial" ~ "Simultaneous",
      scale == "Design Copying General" ~ "Simultaneous",
      scale == "Recall vs Recognition" ~ "",
      scale == "Fingertip Tapping Dominant Hand Repetitions" ~ "Successive",
      scale == "Fingertip Tapping Dominant Hand Sequences" ~ "Successive",
      scale == "Fingertip Tapping Nondominant Hand Repetitions" ~ "Planning",
      scale == "Fingertip Tapping Nondominant Hand Sequences" ~ "Planning",
      scale == "Fingertip Tapping Dominant Hand" ~ "Planning",
      scale == "Fingertip Tapping Nondominant Hand" ~ "Planning",
      scale == "Fingertip Tapping Repetitions" ~ "Planning",
      scale == "Fingertip Tapping Sequences" ~ "Planning",
      scale == "Dominant vs. Nondominant" ~ "",
      scale == "Repetitions vs. Sequences" ~ "",
      scale == "Visuomotor Precision Time" ~ "Attention",
      scale == "Visuomotor Precision Errors" ~ "Attention",
      scale == "Visuomotor Precision" ~ "Attention",
      scale == "Visuomotor Precision Pencil Lifts" ~ "Attention",
      scale == "Affect Recognition" ~ "Successive",
      scale == "Affect Recognition Happy Errors" ~ "Successive",
      scale == "Affect Recognition Sad Errors" ~ "Successive",
      scale == "Affect Recognition Neutral Errors" ~ "Successive",
      scale == "Affect Recognition Fear Errors" ~ "Successive",
      scale == "Affect Recognition Angry Errors" ~ "Successive",
      scale == "Affect Recognition Disgust Errors" ~ "Successive",
      scale == "Theory of Mind" ~ "Successive",
      scale == "Theory of Mind Verbal" ~ "Successive",
      scale == "Arrows" ~ "Successive",
      scale == "Design Copying General" ~ "Planning",
      scale == "Design Copying Process" ~ "Planning",
      scale == "Design Copying Process Global" ~ "Planning",
      scale == "Design Copying Process Local" ~ "Planning",
      scale == "Design Copying Process Motor" ~ "Planning",
      # new
      scale == "Memory for Faces" ~ "Simultaneous",
      scale == "Memory for Faces Delayed" ~ "Simultaneous",
      scale == "Word List Interference-Repetition" ~ "Successive",
      scale == "Word List Interference-Recall" ~ "Successive",
      scale == "Geometric Puzzles" ~ "Simultaneous",
      TRUE ~ as.character(pass)
    )
  )
```

## Verbal vs Nonverbal

As necessary.

```{r verbal}
table <-
  table |>
  mutate(
    verbal = case_when(
      scale == "Auditory Attention Correct" ~ "Verbal",
      scale == "Auditory Attention" ~ "Verbal",
      scale == "Auditory Attention Omission Errors" ~ "Verbal",
      scale == "Auditory Attention Commission Errors" ~ "Verbal",
      scale == "Auditory Attention Inhibitory Errors" ~ "Verbal",
      scale == "Response Set Correct" ~ "Verbal",
      scale == "Response Set" ~ "Verbal",
      scale == "Response Set Omission Errors" ~ "Verbal",
      scale == "Response Set Commission Errors" ~ "Verbal",
      scale == "Response Set Inhibitory Errors" ~ "Verbal",
      scale == "AA vs. RS" ~ "",
      scale == "Clocks" ~ "Nonverbal",
      scale == "List Memory and List Memory Delayed" ~ "Verbal",
      scale == "Narrative Memory Free and Cued Recall" ~ "Verbal",
      scale == "Narrative Memory Free Recall" ~ "Verbal",
      scale == "Narrative Memory Recognition" ~ "Verbal",
      scale == "Recall vs Recognition" ~ "",
      scale == "Memory for Designs" ~ "Nonverbal",
      scale == "Memory for Designs Content" ~ "Nonverbal",
      scale == "Memory for Designs Spatial" ~ "Nonverbal",
      scale == "Memory for Designs Delayed" ~ "Nonverbal",
      scale == "Memory for Designs Delayed Content" ~ "Nonverbal",
      scale == "Memory for Designs Delayed Spatial" ~ "Nonverbal",
      scale == "Visuomotor Precision Time" ~ "Nonverbal",
      scale == "Visuomotor Precision Errors" ~ "Nonverbal",
      scale == "Visuomotor Precision" ~ "Nonverbal",
      scale == "Visuomotor Precision Pencil Lifts" ~ "Nonverbal",
      scale == "Animal Sorting Correct Sorts" ~ "Nonverbal",
      scale == "Animal Sorting Errors" ~ "Nonverbal",
      scale == "Animal Sorting Repeated Sort Errors" ~ "Nonverbal",
      scale == "Animal Sorting Novel Sort Errors" ~ "Nonverbal",
      scale == "Animal Sorting" ~ "Nonverbal",
      scale == "Naming Time" ~ "Verbal",
      scale == "Naming" ~ "Verbal",
      scale == "Naming Errors" ~ "Verbal",
      scale == "Naming Self-Corrected Errors" ~ "Verbal",
      scale == "Naming Uncorrected Errors" ~ "Verbal",
      scale == "Inhibition Time" ~ "Verbal",
      scale == "Inhibition" ~ "Verbal",
      scale == "Inhibition Errors" ~ "Verbal",
      scale == "Inhibition Self-Corrected Errors" ~ "Verbal",
      scale == "Inhibition Uncorrected Errors" ~ "Verbal",
      scale == "Switching Time" ~ "Verbal",
      scale == "Switching" ~ "Verbal",
      scale == "Switching Errors" ~ "Verbal",
      scale == "Switching Self-Corrected Errors" ~ "Verbal",
      scale == "Switching Uncorrected Errors" ~ "Verbal",
      scale == "Naming vs. Inhibition" ~ "",
      scale == "Inhibition vs. Switching" ~ "Verbal",
      scale == "Inhibition Total Errors" ~ "Verbal",
      scale == "Comprehension of Instructions" ~ "Verbal",
      scale == "Speeded Naming Time" ~ "Verbal",
      scale == "Speeded Naming Correct" ~ "Verbal",
      scale == "Speeded Naming" ~ "Verbal",
      scale == "Speeded Naming Self-Corrected Errors" ~ "Verbal",
      scale == "Word Generation-Semantic" ~ "Verbal",
      scale == "Word Generation-Initial Letter" ~ "Verbal",
      scale == "Semantic vs. Initial Letter" ~ "",
      scale == "Fingertip Tapping Dominant Hand Repetitions" ~ "Nonverbal",
      scale == "Fingertip Tapping Dominant Hand Sequences" ~ "Nonverbal",
      scale == "Fingertip Tapping Nondominant Hand Repetitions" ~ "Nonverbal",
      scale == "Fingertip Tapping Nondominant Hand Sequences" ~ "Nonverbal",
      scale == "Fingertip Tapping Dominant Hand" ~ "Nonverbal",
      scale == "Fingertip Tapping Nondominant Hand" ~ "Nonverbal",
      scale == "Fingertip Tapping Repetitions" ~ "Nonverbal",
      scale == "Fingertip Tapping Sequences" ~ "Nonverbal",
      scale == "Dominant vs. Nondominant" ~ "",
      scale == "Repetitions vs. Sequences" ~ "",
      scale == "Affect Recognition" ~ "Verbal",
      scale == "Affect Recognition Happy Errors" ~ "Verbal",
      scale == "Affect Recognition Sad Errors" ~ "Verbal",
      scale == "Affect Recognition Neutral Errors" ~ "Verbal",
      scale == "Affect Recognition Fear Errors" ~ "Verbal",
      scale == "Affect Recognition Angry Errors" ~ "Verbal",
      scale == "Affect Recognition Disgust Errors" ~ "Verbal",
      scale == "Theory of Mind" ~ "Verbal",
      scale == "Theory of Mind Verbal" ~ "Verbal",
      scale == "Arrows" ~ "Nonverbal",
      scale == "Design Copying General" ~ "Nonverbal",
      scale == "Design Copying Process" ~ "Nonverbal",
      scale == "Design Copying Process Global" ~ "Nonverbal",
      scale == "Design Copying Process Local" ~ "Nonverbal",
      scale == "Design Copying Process Motor" ~ "Nonverbal",
      # new
      scale == "Memory for Faces" ~ "Nonverbal",
      scale == "Memory for Faces Delayed" ~ "Nonverbal",
      scale == "Word List Interference-Repetition" ~ "Verbal",
      scale == "Word List Interference-Recall" ~ "Verbal",
      scale == "Geometric Puzzles" ~ "Nonverbal",
      TRUE ~ as.character(verbal)
    )
  )
```

## Timed vs Untimed

```{r timed}
table <-
  table |>
  mutate(
    timed = case_when(
      scale == "Auditory Attention Correct" ~ "Timed",
      scale == "Auditory Attention" ~ "Timed",
      scale == "Auditory Attention Omission Errors" ~ "Timed",
      scale == "Auditory Attention Commission Errors" ~ "Timed",
      scale == "Auditory Attention Inhibitory Errors" ~ "Timed",
      scale == "Response Set Correct" ~ "Timed",
      scale == "Response Set" ~ "Timed",
      scale == "Response Set Omission Errors" ~ "Timed",
      scale == "Response Set Commission Errors" ~ "Timed",
      scale == "Response Set Inhibitory Errors" ~ "Timed",
      scale == "AA vs. RS" ~ "",
      scale == "Clocks" ~ "Untimed",
      scale == "List Memory and List Memory Delayed" ~ "Untimed",
      scale == "Narrative Memory Free and Cued Recall" ~ "Untimed",
      scale == "Narrative Memory Free Recall" ~ "Untimed",
      scale == "Narrative Memory Recognition" ~ "Untimed",
      scale == "Recall vs Recognition" ~ "",
      scale == "Visuomotor Precision Time" ~ "Timed",
      scale == "Visuomotor Precision Errors" ~ "Timed",
      scale == "Visuomotor Precision" ~ "Timed",
      scale == "Visuomotor Precision Pencil Lifts" ~ "Timed",
      scale == "Affect Recognition" ~ "Untimed",
      scale == "Affect Recognition Happy Errors" ~ "Untimed",
      scale == "Affect Recognition Sad Errors" ~ "Untimed",
      scale == "Affect Recognition Neutral Errors" ~ "Untimed",
      scale == "Affect Recognition Fear Errors" ~ "Untimed",
      scale == "Affect Recognition Angry Errors" ~ "Untimed",
      scale == "Affect Recognition Disgust Errors" ~ "Untimed",
      scale == "Theory of Mind" ~ "Untimed",
      scale == "Theory of Mind Verbal" ~ "Untimed",
      scale == "Arrows" ~ "Untimed",
      scale == "Animal Sorting Correct Sorts" ~ "Untimed",
      scale == "Animal Sorting Errors" ~ "Untimed",
      scale == "Animal Sorting Repeated Sort Errors" ~ "Untimed",
      scale == "Animal Sorting Novel Sort Errors" ~ "Untimed",
      scale == "Animal Sorting" ~ "Untimed",
      scale == "Naming Time" ~ "Timed",
      scale == "Naming" ~ "Timed",
      scale == "Naming Errors" ~ "Timed",
      scale == "Naming Self-Corrected Errors" ~ "Timed",
      scale == "Naming Uncorrected Errors" ~ "Timed",
      scale == "Inhibition Time" ~ "Timed",
      scale == "Inhibition" ~ "Timed",
      scale == "Inhibition Errors" ~ "Timed",
      scale == "Inhibition Self-Corrected Errors" ~ "Timed",
      scale == "Inhibition Uncorrected Errors" ~ "Timed",
      scale == "Switching Time" ~ "Timed",
      scale == "Switching" ~ "Timed",
      scale == "Switching Errors" ~ "Timed",
      scale == "Switching Self-Corrected Errors" ~ "Timed",
      scale == "Switching Uncorrected Errors" ~ "Timed",
      scale == "Naming vs. Inhibition" ~ "",
      scale == "Inhibition vs. Switching" ~ "",
      scale == "Inhibition Total Errors" ~ "Timed",
      scale == "Comprehension of Instructions" ~ "Untimed",
      scale == "Speeded Naming Time" ~ "Timed",
      scale == "Speeded Naming Correct" ~ "Timed",
      scale == "Speeded Naming" ~ "Timed",
      scale == "Speeded Naming Self-Corrected Errors" ~ "Timed",
      scale == "Word Generation-Semantic" ~ "Timed",
      scale == "Word Generation-Initial Letter" ~ "Timed",
      scale == "Semantic vs. Initial Letter" ~ "",
      scale == "Fingertip Tapping Dominant Hand Repetitions" ~ "Timed",
      scale == "Fingertip Tapping Dominant Hand Sequences" ~ "Timed",
      scale == "Fingertip Tapping Nondominant Hand Repetitions" ~ "Timed",
      scale == "Fingertip Tapping Nondominant Hand Sequences" ~ "Timed",
      scale == "Fingertip Tapping Dominant Hand" ~ "Timed",
      scale == "Fingertip Tapping Nondominant Hand" ~ "Timed",
      scale == "Fingertip Tapping Repetitions" ~ "Timed",
      scale == "Fingertip Tapping Sequences" ~ "Timed",
      scale == "Dominant vs. Nondominant" ~ "",
      scale == "Repetitions vs. Sequences" ~ "",
      scale == "Imitating Hand Positions" ~ "Untimed",
      scale %in% "Design Copying" ~ "Untimed",
      # scale == "Design Copying Process" ~ "Untimed",
      # scale == "Design Copying Process Global" ~ "Untimed",
      # scale == "Design Copying Process Local" ~ "Untimed",
      # scale == "Design Copying Process Motor" ~ "Untimed",
      # new
      scale == "Memory for Faces" ~ "Untimed",
      scale == "Memory for Faces Delayed" ~ "Untimed",
      scale == "Word List Interference-Repetition" ~ "Untimed",
      scale == "Word List Interference-Recall" ~ "Untimed",
      scale == "Geometric Puzzles" ~ "Untimed",
      # MEM
      scale == "Memory for Designs" ~ "Untimed",
      scale == "Memory for Designs Content" ~ "Untimed",
      scale == "Memory for Designs Spatial" ~ "Untimed",
      scale == "Memory for Designs Delayed" ~ "Untimed",
      scale == "Memory for Designs Delayed Content" ~ "Untimed",
      scale == "Memory for Designs Delayed Spatial" ~ "Untimed",
      TRUE ~ as.character(timed)
    )
  )
```

## Score type

As necessary.

```{r type}
table <-
  table |>
  dplyr::mutate(
    score_type = dplyr::case_when(
      scale == "Animal Sorting Errors" ~ "percentile",
      scale == "Animal Sorting Repeated Sort Errors" ~ "percentile",
      scale == "Animal Sorting Novel Sort Errors" ~ "percentile",
      scale == "Naming Errors" ~ "percentile",
      scale == "Naming Self-Corrected Errors" ~ "percentile",
      scale == "Naming Uncorrected Errors" ~ "percentile",
      scale == "Inhibition Errors" ~ "percentile",
      scale == "Inhibition Self-Corrected Errors" ~ "percentile",
      scale == "Inhibition Uncorrected Errors" ~ "percentile",
      scale == "Switching Errors" ~ "percentile",
      scale == "Switching Self-Corrected Errors" ~ "percentile",
      scale == "Switching Uncorrected Errors" ~ "percentile",
      scale == "Design Copying General" ~ "percentile",

      scale == "Auditory Attention Omission Errors" ~ "percentile",
      scale == "Auditory Attention Commission Errors" ~ "percentile",
      scale == "Auditory Attention Inhibitory Errors" ~ "percentile",

      scale == "Response Set Omission Errors" ~ "percentile",
      scale == "Response Set Commission Errors" ~ "percentile",
      scale == "Response Set Inhibitory Errors" ~ "percentile",

      scale == "Narrative Memory Recognition" ~ "percentile",
      scale == "Fingertip Tapping Dominant Hand Repetitions" ~ "percentile",
      scale == "Fingertip Tapping Dominant Hand Sequences" ~ "percentile",
      scale == "Fingertip Tapping Nondominant Hand Repetitions" ~ "percentile",
      scale == "Fingertip Tapping Nondominant Hand Sequences" ~ "percentile",
      TRUE ~ as.character(score_type)
    )
  )
```

## Descriptions

As necessary.

```{r desc}
table <-
  table |>
  mutate(
    description = case_when(
      scale == "Auditory Attention Correct" ~ "sustained auditory attention (correct)",
      scale == "Auditory Attention" ~ "sustained auditory attention",
      scale == "Auditory Attention Omission Errors" ~ "sustained auditory attention (omissions)",
      scale == "Auditory Attention Commission Errors" ~ "sustained auditory attention (comissions)",
      scale == "Auditory Attention Inhibitory Errors" ~ "sustained auditory attention (inhibitory errors)",
      scale == "Response Set Correct" ~ "sustained auditory attention and inhibition",
      scale == "Response Set" ~ "sustained auditory attention and inhibition",
      scale == "Response Set Omission Errors" ~ "sustained auditory attention and inhibition (omissions)",
      scale == "Response Set Commission Errors" ~ "sustained auditory attention and inhibition (commissions)",
      scale == "Response Set Inhibitory Errors" ~ "sustained auditory attention and inhibition (inhibitory errors)",
      scale == "AA vs. RS" ~ "sustained auditory attention and inhibition (contrast)",
      
      scale == "Clocks" ~ "planning and organization of an analog clock",
      
      scale == "Animal Sorting Correct Sorts" ~ "concept formation and abstract reasoning (correct sorts)",
      scale == "Animal Sorting Errors" ~ "concept formation and abstract reasoning (errors)",
      scale == "Animal Sorting Repeated Sort Errors" ~ "concept formation and abstract reasoning (repeated errors)",
      scale == "Animal Sorting Novel Sort Errors" ~ "concept formation and abstract reasoning (novel errors)",
      scale == "Animal Sorting" ~ "concept formation and abstract reasoning",
      scale == "Naming Time" ~ "rapid automatic naming (time)",
      scale == "Naming" ~ "rapid automatic naming",
      scale == "Naming Errors" ~ "rapid automatic naming (errors)",
      scale == "Naming Self-Corrected Errors" ~ "rapid automatic naming (self-corrected errors)",
      scale == "Naming Uncorrected Errors" ~ "rapid automatic naming (uncorrected errors)",
      scale == "Inhibition Time" ~ "inhibition and cognitive control (time)",
      scale == "Inhibition" ~ "inhibition and cognitive control",
      scale == "Inhibition Errors" ~ "inhibition and cognitive control (errors)",
      scale == "Inhibition Self-Corrected Errors" ~ "inhibition and cognitive control (self-corrected errors)",
      scale == "Inhibition Uncorrected Errors" ~ "inhibition and cognitive control (uncorrected errors)",
      scale == "Switching Time" ~ "set-shifting and cognitive flexibility (time)",
      scale == "Switching" ~ "set-shifting and cognitive flexibility",
      scale == "Switching Errors" ~ "set-shifting and cognitive flexibility (errors)",
      scale == "Switching Self-Corrected Errors" ~ "set-shifting and cognitive flexibility (self-corrected errors)",
      scale == "Switching Uncorrected Errors" ~ "set-shifting and cognitive flexibility (uncorrected errors)",
      scale == "Inhibition vs. Switching" ~ "Inhibition vs. Switching",
      scale == "Inhibition Total Errors" ~ "response monitoring during inhibition",
      
      scale == "Comprehension of Instructions" ~ "follow multistep instructions",
      scale == "Speeded Naming" ~ "rapid access to and production of names of colors, shapes, sizes, letters, or numbers",
      scale == "Speeded Naming Time" ~ "naming facility for familiar/overlearned information",
      scale == "Speeded Naming Correct" ~ "naming correct",
      scale == "Speeded Naming Self-Corrected Errors" ~ "response monitoring during naming",
      
      scale == "Word Generation-Semantic" ~ "ability to generate words within specific semantically-related categories in 60-seconds",
      scale == "Word Generation-Initial Letter" ~ "ability to generate words in 60-seconds given a phonemic (letter) cue",
      scale == "Semantic vs. Initial Letter" ~ "semantic vs phonemic word fluency",
      
      scale == "List Memory and List Memory Delayed" ~ "learning and recall of rote information (word list)",
      scale == "Narrative Memory Free Recall" ~ "long-term memory recall of story details",
      scale == "Narrative Memory Free and Cued Recall" ~ "long-term memory recall of story details with cues",
      scale == "Narrative Memory Recognition" ~ "long-term memory recognition of story details",
      scale == "Recall vs Recognition" ~ "memory recall vs recognition",
      
      scale == "Memory for Designs" ~ "immediate memory recall of abstract shape learning",
      scale == "Memory for Designs Content" ~ "immediate memory recall of abstract shape learning (content)",
      scale == "Memory for Designs Spatial" ~ "immediate memory recall of abstract shape learning (spatial)",
      scale == "Memory for Designs Delayed" ~ "delayed memory recall of abstract shape learning",
      scale == "Memory for Designs Delayed Content" ~ "delayed memory recall of abstract shape learning (content)",
      scale == "Memory for Designs Delayed Spatial" ~ "delayed memory recall of abstract shape learning (spatial)",
      
      scale == "Fingertip Tapping Dominant Hand Repetitions" ~ "finger dexterity and motor speed",
      scale == "Fingertip Tapping Dominant Hand Sequences" ~ "rapid motor programing",
      scale == "Fingertip Tapping Nondominant Hand Repetitions" ~ "finger dexterity and motor speed",
      scale == "Fingertip Tapping Nondominant Hand Sequences" ~ "rapid motor programing",
      scale == "Fingertip Tapping Dominant Hand" ~ "finger dexterity dominant hand",
      scale == "Fingertip Tapping Nondominant Hand" ~ "finger dexterity nondominant hand",
      scale == "Fingertip Tapping Repetitions" ~ "finger dexterity and motor speed",
      scale == "Fingertip Tapping Sequences" ~ "rapid motor programing",
      scale == "Imitating Hand Positions" ~ "assess the ability to imitate hand and finger positions",
      scale == "Dominant vs. Nondominant" ~ "Dominant vs. Nondominant",
      scale == "Repetitions vs. Sequences" ~ "Repetitions vs. Sequences",
      scale == "Visuomotor Precision Time" ~ "graphomotor speed and accuracy (time)",
      scale == "Visuomotor Precision Errors" ~ "graphomotor speed and accuracy (errors)",
      scale == "Visuomotor Precision" ~ "graphomotor speed and accuracy",
      scale == "Visuomotor Precision Pencil Lifts" ~ "graphomotor speed and accuracy (pencil control)",
      scale == "Affect Recognition" ~ "the ability to recognize affect from photographs of children's faces in four different tasks",
      scale == "Theory of Mind" ~ "the ability to understand mental functions and another’s point of view",
      scale == "Theory of Mind Verbal" ~ "assesses belief, intention, deception, emotion, imagination/pretending, imitation, and the understanding of other’s thoughts, ideas, and feelings, as well as comprehension of abstract meanings in figurative language",
      
      scale == "Arrows" ~ "visual perception of one-dimensional line orientation",
      scale == "Design Copying General" ~ "copying and visuomotor integration",
      scale == "Design Copying Process" ~ "copying and visuomotor integration process",
      scale == "Design Copying Process Global" ~ "copying and visuomotor integration process global",
      scale == "Design Copying Process Local" ~ "copying and visuomotor integration process local",
      scale == "Design Copying Process Motor" ~ "copying and visuomotor integration process motor",
      # new
      scale == "Memory for Faces" ~ "memory for children's faces",
      scale == "Memory for Faces Delayed" ~ "delayed recall/recognition of children's faces",
      scale == "Word List Interference-Repetition" ~ "verbal associative learning (word pairs) repetition",
      scale == "Word List Interference-Recall" ~ "verbal associative learning (word pairs) recall",
      scale == "Geometric Puzzles" ~ "complex abstract geometric puzzles",
      TRUE ~ as.character(description)
    )
  )
```

# Finalize and save

## Relocate variables

```{r relocate}
nepsy2 <- table |> dplyr::relocate(c(raw_score, score, percentile, range, ci_95), .before = test)
```

## Write out final csv to "csv" directory

```{r writecsv}
readr::write_csv(nepsy2, here::here(patient, "csv", "nepsy2.csv"), col_names = TRUE, na = "")
```

## Cleanup

```{r cleanup}
rm(table, table1, table2, table3, table4, table6, table_list)
```
